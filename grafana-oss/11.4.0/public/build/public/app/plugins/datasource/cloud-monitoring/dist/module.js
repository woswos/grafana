/*! For license information please see module.js.LICENSE.txt */
define(["lodash","@grafana/data","@grafana/runtime","react","@emotion/css","@grafana/ui","rxjs"],((e,t,r,n,o,a,i)=>(()=>{var l={872:(e,t,r)=>{var n=r(781),o=r(7),a=r(959),i=r(241),l=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(a);const s="jwt",c="gce",u="Paste JWT button",p="Upload JWT button",d=["private_key","token_uri","client_email","project_id"],y=({onChange:e,showConfigEditor:t,showPaste:r,showUpload:n,isPasting:i,isUploading:s})=>{const[c,d]=a.useState(),y=o.useTheme2(),m=a.useCallback((e=>{d(null),r()}),[r]),b=a.useCallback((e=>{n(),d(null)}),[n]),v=a.useCallback((r=>{if(""!==r.trim()){let n;try{n=JSON.parse(r)}catch(e){d("Invalid JWT token")}const o=f(n);o.isValid?(t(),e({privateKey:n.private_key,tokenUri:n.token_uri,clientEmail:n.client_email,projectId:n.project_id})):d(o.error)}}),[d,e,t]);return l.default.createElement(l.default.Fragment,null,l.default.createElement(o.Field,{label:"JWT token",invalid:Boolean(c),description:i?"Paste JWT token below":"Upload or paste Google JWT token",error:c},l.default.createElement(l.default.Fragment,null,s&&l.default.createElement("div",{"data-testid":"Configuration drop zone"},o.FileDropzone&&l.default.createElement(o.FileDropzone,{options:{multiple:!1,accept:".json"},readAs:"readAsText",onLoad:e=>{v(e)}},l.default.createElement("p",{style:{margin:0,fontSize:`${y.typography.h4.fontSize}`,textAlign:"center"}},"Drop the Google JWT file here",l.default.createElement("br",null),l.default.createElement("br",null),l.default.createElement(o.Button,{fill:"outline"},"Click to browse files")))),i&&l.default.createElement(o.TextArea,{"data-testid":"Configuration text area",autoFocus:!0,invalid:Boolean(c),placeholder:"Paste Google JWT token here",onBlur:e=>v(e.currentTarget.value),rows:12}))),!i&&l.default.createElement(l.default.Fragment,null,l.default.createElement(o.Button,{"data-testid":u,type:"button",fill:"outline",style:{color:`${y.colors.primary.text}`},onClick:m},"Paste JWT Token"),l.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),i&&l.default.createElement(l.default.Fragment,null,l.default.createElement(o.Button,{"data-testid":p,type:"button",fill:"outline",style:{color:`${y.colors.primary.text}`},onClick:()=>{n()}},"Upload JWT Token"),l.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or")),l.default.createElement(o.Button,{"data-testid":"Fill JWT info manually",type:"button",fill:"outline",style:{color:`${y.colors.primary.text}`},onClick:t},"Fill In JWT Token manually"),i&&c&&l.default.createElement(o.Field,null,l.default.createElement(o.Button,{type:"button",fill:"outline",style:{color:`${y.colors.primary.text}`},onClick:b},"Upload JWT Token")))},f=e=>{if(!i.isObject(e))return{isValid:!1,error:"Invalid JWT token"};const t=d.filter((t=>!e[t]));return t.length>0?{isValid:!1,error:`Missing keys: ${t.join(", ")}`}:{isValid:!0}},{SecretFormField:m}=o.LegacyForms;var b;!function(e){e.PATH="path",e.JWT="jwt"}(b||(b={}));const v=({options:e,onReset:t,onOptionsChange:r,showPaste:a,showUpload:i})=>{var s;const[c,d]=l.default.useState((e=>"privateKeyPath"in e&&""!==e.privateKeyPath?b.PATH:b.JWT)(e.jsonData)),y=t=>n.onUpdateDatasourceJsonDataOption({options:e,onOptionsChange:r},t),f=()=>{c===b.JWT?d(b.PATH):d(b.JWT)},v=o.useTheme2(),h=l.default.createElement("span",null,c===b.PATH?l.default.createElement("a",{className:"external-link",onClick:f,"data-testid":"Show private key input"},"Paste private key"):"Paste private key"," ","or  ",c===b.JWT?l.default.createElement("a",{className:"external-link",onClick:f,"data-testid":"Show private key path input"},"provide path to private file"):"provide path to private key file"),g={isConfigured:Boolean(e.secureJsonFields.privateKey),value:(null===(s=e.secureJsonData)||void 0===s?void 0:s.privateKey)||"",placeholder:"Enter Private key",onReset:()=>t(),onChange:n.onUpdateDatasourceSecureJsonDataOption({options:e,onOptionsChange:r},"privateKey"),"data-testid":"Private Key Input"};return l.default.createElement("div",{"data-testid":"JWT form"},l.default.createElement(o.Field,{label:"Project ID"},l.default.createElement(o.Input,{id:"defaultProject",width:60,value:e.jsonData.defaultProject||"",onChange:y("defaultProject")})),l.default.createElement(o.Field,{label:"Client email"},l.default.createElement(o.Input,{width:60,id:"clientEmail",value:e.jsonData.clientEmail||"",onChange:y("clientEmail")})),l.default.createElement(o.Field,{label:"Token URI"},l.default.createElement(o.Input,{width:60,id:"tokenUri",value:e.jsonData.tokenUri||"",onChange:y("tokenUri")})),c===b.PATH&&l.default.createElement(o.Field,{label:"Private key path",description:h},l.default.createElement(o.Input,{width:60,id:"privateKeyPath",value:e.jsonData.privateKeyPath||"",placeholder:"File location of your private key (e.g. /etc/secrets/gce.pem)",onChange:y("privateKeyPath"),"data-testid":"Private Key Path Input"})),c===b.JWT&&l.default.createElement(l.default.Fragment,null,o.SecretInput?l.default.createElement(o.Field,{label:"Private key",description:h},l.default.createElement(o.SecretInput,Object.assign({},g,{width:60}))):l.default.createElement(m,Object.assign({},g,{label:"Private key",labelWidth:10,inputWidth:20}))),l.default.createElement(l.default.Fragment,null,l.default.createElement(o.Button,{"data-testid":u,type:"button",fill:"outline",style:{color:`${v.colors.primary.text}`},onClick:a},"Paste JWT Token"),l.default.createElement("span",{style:{paddingRight:"10px",paddingLeft:"10px"}},"or"),l.default.createElement(o.Button,{"data-testid":p,type:"button",fill:"outline",style:{color:`${v.colors.primary.text}`},onClick:i},"Upload JWT Token")))};function h(e){const{options:t,onOptionsChange:r,authOptions:i}=e,{jsonData:u,secureJsonFields:p,secureJsonData:d}=t,f=()=>Boolean(u.clientEmail&&u.defaultProject&&u.tokenUri&&(p&&p.privateKey||u.privateKeyPath));u.authenticationType||(u.authenticationType=s);const[m,b]=a.useState(g(u.authenticationType)),[h,O]=a.useState(f()),[j,E]=a.useState(!1),[S,T]=a.useState(!0),P=()=>{E(!1),T(!0),O(!1)},x=()=>{E(!0),T(!1),O(!1)};return l.default.createElement(l.default.Fragment,null,l.default.createElement(o.FieldSet,{label:"Authentication"},l.default.createElement(o.Field,{label:"Authentication type"},l.default.createElement(o.RadioButtonGroup,{options:i,value:u.authenticationType||s,onChange:e=>{O(f()),r(Object.assign(Object.assign({},t),{jsonData:Object.assign(Object.assign({},t.jsonData),{authenticationType:e})})),b(g(e))}}))),m&&l.default.createElement(o.FieldSet,{label:"JWT Key Details"},h?l.default.createElement(v,{options:t,onReset:()=>(e=>{const n=Object.assign({},d),o=Object.assign({},t.jsonData);delete o.clientEmail,delete o.defaultProject,delete o.tokenUri,delete o.privateKeyPath,delete n.privateKey,b(!0),O(!1),r(Object.assign(Object.assign({},t),{secureJsonFields:Object.assign(Object.assign({},t.secureJsonFields),{privateKey:!1}),secureJsonData:n,jsonData:o}))})(),onOptionsChange:r,showUpload:P,showPaste:x}):l.default.createElement(y,{showConfigEditor:()=>{O(!0)},showUpload:P,showPaste:x,isPasting:j,isUploading:S,onChange:e=>{r(Object.assign(Object.assign({},t),{secureJsonFields:Object.assign(Object.assign({},p),{privateKey:!0}),secureJsonData:Object.assign(Object.assign({},d),{privateKey:e.privateKey}),jsonData:Object.assign(Object.assign({},u),{clientEmail:e.clientEmail,defaultProject:e.projectId,tokenUri:e.tokenUri})}))}})," "),u.authenticationType===c&&l.default.createElement(o.Field,{label:"Default project"},l.default.createElement(o.Input,{id:"defaultProject",width:60,value:t.jsonData.defaultProject||"",onChange:n.onUpdateDatasourceJsonDataOption(e,"defaultProject")})))}const g=e=>e===s||void 0===e,O=[{label:"Google JWT File",value:s,ariaLabel:"JWT button"},{label:"GCE Default Service Account",value:c,ariaLabel:"GCE button"}];t.ConnectionConfig=e=>{const{options:{jsonData:t}}=e;t.authenticationType||(t.authenticationType=s);const r=t.authenticationType===s||void 0===t.authenticationType;return l.default.createElement(l.default.Fragment,null,l.default.createElement(h,Object.assign({authOptions:O},e)),l.default.createElement("div",{className:"grafana-info-box",style:{marginTop:"16px"},"data-testid":"Configuration help box"},l.default.createElement("p",null,"Don’t know how to get a service account key file or create a service account? Read more"," ",l.default.createElement("a",{className:"external-link",target:"_blank",rel:"noopener noreferrer",href:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/google-authentication/"},"in the documentation."))),!r&&l.default.createElement(o.Alert,{title:"",severity:"info"},"Verify GCE default service account by clicking Save & Test"))}},80:(e,t,r)=>{"use strict";e.exports=r(872)},635:e=>{"use strict";e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=void 0,o=void 0,a=void 0,i=[];return function(){var s=function(e){return"function"==typeof e?e():e}(t),c=(new Date).getTime(),u=!n||c-n>s;n=c;for(var p=arguments.length,d=Array(p),y=0;y<p;y++)d[y]=arguments[y];if(u&&r.leading)return r.accumulate?Promise.resolve(e.call(this,[d])).then((function(e){return e[0]})):Promise.resolve(e.call.apply(e,[this].concat(d)));if(o?clearTimeout(a):o=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}(),i.push(d),a=setTimeout(l.bind(this),s),r.accumulate){var f=i.length-1;return o.promise.then((function(e){return e[f]}))}return o.promise};function l(){var t=o;clearTimeout(a),Promise.resolve(r.accumulate?e.call(this,i):e.apply(this,i[i.length-1])).then(t.resolve,t.reject),i=[],o=null}}},513:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var n,o,a;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(o=n;0!=o--;)if(!e(t[o],r[o]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(a=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(o=n;0!=o--;)if(!Object.prototype.hasOwnProperty.call(r,a[o]))return!1;for(o=n;0!=o--;){var i=a[o];if(!e(t[i],r[i]))return!1}return!0}return t!=t&&r!=r}},44:(e,t,r)=>{"use strict";var n=r(959),o=Symbol.for("react.element"),a=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,a={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)i.call(t,n)&&!s.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===a[n]&&(a[n]=t[n]);return{$$typeof:o,type:e,key:c,ref:u,props:a,_owner:l.current}}t.Fragment=a,t.jsx=c,t.jsxs=c},728:(e,t,r)=>{"use strict";e.exports=r(44)},89:e=>{"use strict";e.exports=o},781:e=>{"use strict";e.exports=t},531:e=>{"use strict";e.exports=r},7:e=>{"use strict";e.exports=a},241:t=>{"use strict";t.exports=e},959:e=>{"use strict";e.exports=n},269:e=>{"use strict";e.exports=i}},s={};function c(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return l[e](r,r.exports,c),r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var u={};return(()=>{"use strict";c.r(u),c.d(u,{plugin:()=>Qn});var e=c(241),t=c(781),r=c(531),n=c(728),o=c(89),a=c(959),i=c.n(a);class l extends a.PureComponent{render(){return(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Cloud Monitoring alias patterns"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{children:"Format the legend keys any way you want by using alias patterns. Format the legend keys any way you want by using alias patterns."}),"Example:",(0,n.jsx)("code",{children:"{{metric.name}} - {{metric.label.instance_name}}"}),(0,n.jsx)("br",{}),"Result:   ",(0,n.jsx)("code",{children:"cpu/usage_time - server1-europe-west-1"}),(0,n.jsx)("br",{}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:"Patterns:"}),(0,n.jsx)("br",{}),(0,n.jsxs)("ul",{className:o.css`
              list-style: none;
            `,children:[(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{metadata.system_labels.name}}"})," = Meta data system labels e.g. metadata.system_labels.name. For this to work, the needs to be included in the group by"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{metadata.user_labels.name}}"})," = Meta data user labels e.g. metadata.user_labels.name. For this to work, the needs to be included in the group by"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{bucket}}"})," = bucket boundary for distribution metrics when using a heatmap in Grafana"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{project}}"})," = The project name that was specified in the query editor"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{service}}"})," = The service id that was specified in the SLO query editor"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{slo}}"})," = The SLO id that was specified in the SLO query editor"]}),(0,n.jsxs)("li",{children:[(0,n.jsx)("code",{children:"{{selector}}"})," = The Selector function that was specified in the SLO query editor"]})]})]})]})}}var s=c(7),p=Object.defineProperty,d=Object.defineProperties,y=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,v=(e,t,r)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,h=(e,t)=>{for(var r in t||(t={}))m.call(t,r)&&v(e,r,t[r]);if(f)for(var r of f(t))b.call(t,r)&&v(e,r,t[r]);return e};const g=({dataSourceName:e,docsLink:t,hasRequiredFields:r=!0,className:n})=>{const a=(0,s.useTheme2)(),l={container:(0,o.css)({p:{margin:0},"p + p":{marginTop:a.spacing(2)}}),text:(0,o.css)((c=h({},a.typography.body),u={color:a.colors.text.secondary,a:(0,o.css)({color:a.colors.text.link,textDecoration:"underline","&:hover":{textDecoration:"none"}})},d(c,y(u))))};var c,u;return i().createElement("div",{className:(0,o.cx)(l.container,n)},i().createElement("p",{className:l.text},"Before you can use the ",e," data source, you must configure it below or in the config file. For detailed instructions,"," ",i().createElement("a",{href:t,target:"_blank",rel:"noreferrer"},"view the documentation"),"."),r&&i().createElement("p",{className:l.text},i().createElement("i",null,"Fields marked with * are required")))};var O=Object.defineProperty,j=Object.defineProperties,E=Object.getOwnPropertyDescriptors,S=Object.getOwnPropertySymbols,T=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable,x=(e,t,r)=>t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,I=(e,t)=>{for(var r in t||(t={}))T.call(t,r)&&x(e,r,t[r]);if(S)for(var r of S(t))P.call(t,r)&&x(e,r,t[r]);return e};const w=({children:e,title:t,description:r,isCollapsible:n=!1,isInitiallyOpen:l=!0,kind:c="section",className:u})=>{const{colors:p,typography:d,spacing:y}=(0,s.useTheme2)(),[f,m]=(0,a.useState)(!n||l),b=f?"angle-up":"angle-down",v="sub-section"===c,h=`${f?"Collapse":"Expand"} section ${t}`,g={header:(0,o.css)({display:"flex",justifyContent:"space-between",alignItems:"center"}),title:(0,o.css)({margin:0}),subtitle:(0,o.css)({margin:0,fontWeight:d.fontWeightRegular}),descriptionText:(0,o.css)((O=I({marginTop:y(v?.25:.5),marginBottom:0},d.bodySmall),S={color:p.text.secondary},j(O,E(S)))),content:(0,o.css)({marginTop:y(2)})};var O,S;return i().createElement("div",{className:u},i().createElement("div",{className:g.header},"section"===c?i().createElement("h3",{className:g.title},t):i().createElement("h6",{className:g.subtitle},t),n&&i().createElement(s.IconButton,{name:b,onClick:()=>m(!f),type:"button",size:"xl","aria-label":h})),r&&i().createElement("p",{className:g.descriptionText},r),f&&i().createElement("div",{className:g.content},e))};var N=Object.defineProperty,D=Object.defineProperties,L=Object.getOwnPropertyDescriptors,_=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable,R=(e,t,r)=>t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const U=e=>{var t,r=e,{children:n}=r,o=((e,t)=>{var r={};for(var n in e)C.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&_)for(var n of _(e))t.indexOf(n)<0&&A.call(e,n)&&(r[n]=e[n]);return r})(r,["children"]);return i().createElement(w,(t=((e,t)=>{for(var r in t||(t={}))C.call(t,r)&&R(e,r,t[r]);if(_)for(var r of _(t))A.call(t,r)&&R(e,r,t[r]);return e})({},o),D(t,L({kind:"section"}))),n)};var M=c(80);function k(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){k(e,t,r[t])}))}return e}class Q extends a.PureComponent{render(){const{options:e,onOptionsChange:t}=this.props;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(g,{dataSourceName:"Google Cloud Monitoring",docsLink:"https://grafana.com/docs/grafana/latest/datasources/google-cloud-monitoring/",hasRequiredFields:!0}),(0,n.jsx)(s.Divider,{}),(0,n.jsx)(M.ConnectionConfig,(o=G({},this.props),a={onOptionsChange:this.handleOnOptionsChange},a=null!=a?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(a,e))})),o)),r.config.secureSocksDSProxyEnabled&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.Divider,{}),(0,n.jsx)(U,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source. This includes Secure Socks Proxy.",isCollapsible:!0,isInitiallyOpen:void 0!==e.jsonData.enableSecureSocksProxy,children:(0,n.jsx)(s.SecureSocksProxySettings,{options:e,onOptionsChange:t})})]})]});var o,a}constructor(...e){super(...e),k(this,"handleOnOptionsChange",(e=>{(e.jsonData.privateKeyPath||e.secureJsonFields.privateKey)&&(0,r.reportInteraction)("grafana_cloud_monitoring_config_changed",{authenticationType:"JWT",privateKey:e.secureJsonFields.privateKey,privateKeyPath:!!e.jsonData.privateKeyPath}),this.props.onOptionsChange(e)}))}}var q=c(513),B=c.n(q),F=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;const $=e=>{var t=e,{children:r}=t,n=((e,t)=>{var r={};for(var n in e)V.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&F)for(var n of F(e))t.indexOf(n)<0&&K.call(e,n)&&(r[n]=e[n]);return r})(t,["children"]);const o=(0,s.useStyles2)((0,a.useCallback)((e=>Y(e,n)),[n]));return i().createElement("div",{className:o.root},r)},Y=(e,t)=>{var r,n,a;return{root:(0,o.css)({display:"flex",flexDirection:null!=(r=t.direction)?r:"row",flexWrap:null==(n=t.wrap)||n?"wrap":void 0,alignItems:t.alignItems,gap:e.spacing(null!=(a=t.gap)?a:2),flexGrow:t.flexGrow})}},J=({children:e})=>i().createElement($,{gap:.5,direction:"column"},e),W={components:{queryEditor:{container:"data-testid cloud-monitoring-query-editor",header:{select:"data-testid cloud-monitoring-header"},visualMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-visual-metrics-query-editor"}},mqlMetricsQueryEditor:{container:{input:"data-testid cloud-monitoring-mql-query-editor"}},sloQueryEditor:{container:{input:"data-testid cloud-monitoring-slo-query-editor"}},promQlQueryEditor:{container:{input:"data-testid cloud-monitoring-prom-ql-query-editor"}}}}};var z,H,X,Z,ee,te;!function(e){e.ANNOTATION="annotation",e.PROMQL="promQL",e.SLO="slo",e.TIME_SERIES_LIST="timeSeriesList",e.TIME_SERIES_QUERY="timeSeriesQuery"}(z||(z={})),function(e){e.Delta="delta",e.None="none",e.Rate="rate"}(H||(H={})),function(e){e.CUMULATIVE="CUMULATIVE",e.DELTA="DELTA",e.GAUGE="GAUGE",e.METRIC_KIND_UNSPECIFIED="METRIC_KIND_UNSPECIFIED"}(X||(X={})),function(e){e.BOOL="BOOL",e.DISTRIBUTION="DISTRIBUTION",e.DOUBLE="DOUBLE",e.INT64="INT64",e.MONEY="MONEY",e.STRING="STRING",e.VALUE_TYPE_UNSPECIFIED="VALUE_TYPE_UNSPECIFIED"}(Z||(Z={})),function(e){e.ALIGN_COUNT="ALIGN_COUNT",e.ALIGN_COUNT_FALSE="ALIGN_COUNT_FALSE",e.ALIGN_COUNT_TRUE="ALIGN_COUNT_TRUE",e.ALIGN_DELTA="ALIGN_DELTA",e.ALIGN_FRACTION_TRUE="ALIGN_FRACTION_TRUE",e.ALIGN_INTERPOLATE="ALIGN_INTERPOLATE",e.ALIGN_MAX="ALIGN_MAX",e.ALIGN_MEAN="ALIGN_MEAN",e.ALIGN_MIN="ALIGN_MIN",e.ALIGN_NEXT_OLDER="ALIGN_NEXT_OLDER",e.ALIGN_NONE="ALIGN_NONE",e.ALIGN_PERCENTILE_05="ALIGN_PERCENTILE_05",e.ALIGN_PERCENTILE_50="ALIGN_PERCENTILE_50",e.ALIGN_PERCENTILE_95="ALIGN_PERCENTILE_95",e.ALIGN_PERCENTILE_99="ALIGN_PERCENTILE_99",e.ALIGN_PERCENT_CHANGE="ALIGN_PERCENT_CHANGE",e.ALIGN_RATE="ALIGN_RATE",e.ALIGN_STDDEV="ALIGN_STDDEV",e.ALIGN_SUM="ALIGN_SUM"}(ee||(ee={})),function(e){e.Aggregations="aggregations",e.Aligners="aligners",e.AlignmentPeriods="alignmentPeriods",e.DefaultProject="defaultProject",e.LabelKeys="labelKeys",e.LabelValues="labelValues",e.MetricTypes="metricTypes",e.Projects="projects",e.ResourceTypes="resourceTypes",e.SLO="slo",e.SLOServices="sloServices",e.Selectors="selectors",e.Services="services"}(te||(te={}));const re=({v:e=0,h:t=0,layout:r="block"})=>{const n=(0,s.useStyles2)((0,a.useCallback)((n=>ne(n,{v:e,h:t,layout:r})),[e,t,r]));return i().createElement("span",{className:(0,o.cx)(n.wrapper)})},ne=(e,t)=>{var r,n;return{wrapper:(0,o.css)([{paddingRight:e.spacing(null!=(r=t.h)?r:0),paddingBottom:e.spacing(null!=(n=t.v)?n:0)},"inline"===t.layout&&{display:"inline-block"},"block"===t.layout&&{display:"block"}])}};var oe=Object.defineProperty,ae=Object.getOwnPropertySymbols,ie=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable,se=(e,t,r)=>t in e?oe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const ce=e=>{var t;const r=e,{label:n,optional:o,tooltip:l,tooltipInteractive:c,children:u,width:p}=r,d=((e,t)=>{var r={};for(var n in e)ie.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&ae)for(var n of ae(e))t.indexOf(n)<0&&le.call(e,n)&&(r[n]=e[n]);return r})(r,["label","optional","tooltip","tooltipInteractive","children","width"]),y=(0,s.useStyles2)((0,a.useCallback)((e=>ue(e,p)),[p])),f=(null==d?void 0:d.htmlFor)||(null==(t=s.ReactUtils)?void 0:t.getChildId(u)),m=i().createElement(i().Fragment,null,i().createElement("label",{className:y.label,htmlFor:f},n,o&&i().createElement("span",{className:y.optional}," - optional"),l&&i().createElement(s.Tooltip,{placement:"top",content:l,theme:"info",interactive:c},i().createElement(s.Icon,{tabIndex:0,name:"info-circle",size:"sm",className:y.icon}))),i().createElement(re,{v:.5}));return i().createElement("div",{className:y.root},i().createElement(s.Field,((e,t)=>{for(var r in t||(t={}))ie.call(t,r)&&se(e,r,t[r]);if(ae)for(var r of ae(t))le.call(t,r)&&se(e,r,t[r]);return e})({className:y.field,label:m},d),u))},ue=(e,t)=>({root:(0,o.css)({minWidth:e.spacing(null!=t?t:0)}),label:(0,o.css)({fontSize:12,fontWeight:e.typography.fontWeightMedium}),optional:(0,o.css)({fontStyle:"italic",color:e.colors.text.secondary}),field:(0,o.css)({marginBottom:0}),icon:(0,o.css)({color:e.colors.text.secondary,marginLeft:e.spacing(1),":hover":{color:e.colors.text.primary}})}),pe=({refId:t,value:r="",onChange:o})=>{const[i,l]=(0,a.useState)(null!=r?r:""),c=(0,e.debounce)(o,1e3);return(0,n.jsx)(ce,{label:"Alias by",children:(0,n.jsx)(s.Input,{id:`${t}-alias-by`,value:i,onChange:e=>{l(e.currentTarget.value),c(e.currentTarget.value)}})})},de=({children:e})=>{const t=(0,s.useStyles2)(ye);return i().createElement("div",{className:t.root},i().createElement($,{gap:2},e))},ye=e=>({root:(0,o.css)({padding:e.spacing(1),backgroundColor:e.colors.background.secondary,borderRadius:e.shape.borderRadius(1)})}),fe=[{text:"none",value:"ALIGN_NONE",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION,Z.STRING,Z.VALUE_TYPE_UNSPECIFIED,Z.BOOL],metricKinds:[X.GAUGE]},{text:"delta",value:"ALIGN_DELTA",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.CUMULATIVE,X.DELTA]},{text:"rate",value:"ALIGN_RATE",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.CUMULATIVE,X.DELTA]},{text:"interpolate",value:"ALIGN_INTERPOLATE",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE]},{text:"next older",value:"ALIGN_NEXT_OLDER",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION,Z.STRING,Z.VALUE_TYPE_UNSPECIFIED,Z.BOOL],metricKinds:[X.GAUGE]},{text:"min",value:"ALIGN_MIN",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA]},{text:"max",value:"ALIGN_MAX",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA]},{text:"mean",value:"ALIGN_MEAN",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA]},{text:"count",value:"ALIGN_COUNT",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.BOOL],metricKinds:[X.GAUGE,X.DELTA]},{text:"sum",value:"ALIGN_SUM",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA]},{text:"stddev",value:"ALIGN_STDDEV",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA]},{text:"count true",value:"ALIGN_COUNT_TRUE",valueTypes:[Z.BOOL],metricKinds:[X.GAUGE]},{text:"count false",value:"ALIGN_COUNT_FALSE",valueTypes:[Z.BOOL],metricKinds:[X.GAUGE]},{text:"fraction true",value:"ALIGN_FRACTION_TRUE",valueTypes:[Z.BOOL],metricKinds:[X.GAUGE]},{text:"percentile 99",value:"ALIGN_PERCENTILE_99",valueTypes:[Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA]},{text:"percentile 95",value:"ALIGN_PERCENTILE_95",valueTypes:[Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA]},{text:"percentile 50",value:"ALIGN_PERCENTILE_50",valueTypes:[Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA]},{text:"percentile 05",value:"ALIGN_PERCENTILE_05",valueTypes:[Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA]},{text:"percent change",value:"ALIGN_PERCENT_CHANGE",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA]}],me=[{text:"none",value:"REDUCE_NONE",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION,Z.BOOL,Z.STRING],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE,X.METRIC_KIND_UNSPECIFIED]},{text:"mean",value:"REDUCE_MEAN",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE]},{text:"min",value:"REDUCE_MIN",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE,X.METRIC_KIND_UNSPECIFIED]},{text:"max",value:"REDUCE_MAX",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE,X.METRIC_KIND_UNSPECIFIED]},{text:"sum",value:"REDUCE_SUM",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE,X.METRIC_KIND_UNSPECIFIED]},{text:"std. dev.",value:"REDUCE_STDDEV",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE,X.METRIC_KIND_UNSPECIFIED]},{text:"count",value:"REDUCE_COUNT",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION,Z.BOOL,Z.STRING],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE]},{text:"count true",value:"REDUCE_COUNT_TRUE",valueTypes:[Z.BOOL],metricKinds:[X.GAUGE,X.DELTA]},{text:"count false",value:"REDUCE_COUNT_FALSE",valueTypes:[Z.BOOL],metricKinds:[X.GAUGE,X.DELTA]},{text:"99th percentile",value:"REDUCE_PERCENTILE_99",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE]},{text:"95th percentile",value:"REDUCE_PERCENTILE_95",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE]},{text:"50th percentile",value:"REDUCE_PERCENTILE_50",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE]},{text:"5th percentile",value:"REDUCE_PERCENTILE_05",valueTypes:[Z.INT64,Z.DOUBLE,Z.MONEY,Z.DISTRIBUTION],metricKinds:[X.GAUGE,X.DELTA,X.CUMULATIVE]}],be=[{text:"grafana auto",value:"grafana-auto"},{text:"stackdriver auto",value:"stackdriver-auto",hidden:!0},{text:"cloud monitoring auto",value:"cloud-monitoring-auto"},{text:"1m",value:"+60s"},{text:"2m",value:"+120s"},{text:"5m",value:"+300s"},{text:"10m",value:"+600s"},{text:"30m",value:"+1800s"},{text:"1h",value:"+3600s"},{text:"3h",value:"+7200s"},{text:"6h",value:"+21600s"},{text:"1d",value:"+86400s"},{text:"3d",value:"+259200s"},{text:"1w",value:"+604800s"}],ve=[{text:"auto",value:"auto"},{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"1d",value:"1d"},{text:"3d",value:"3d"},{text:"1w",value:"1w"}],he=[{text:"1m",value:"1m"},{text:"2m",value:"2m"},{text:"5m",value:"5m"},{text:"10m",value:"10m"},{text:"30m",value:"30m"},{text:"1h",value:"1h"},{text:"3h",value:"3h"},{text:"6h",value:"6h"},{text:"24h",value:"24h"},{text:"72h",value:"72h"}],ge=["metadata.system_labels.cloud_account","metadata.system_labels.name","metadata.system_labels.region","metadata.system_labels.state","metadata.system_labels.instance_group","metadata.system_labels.node_name","metadata.system_labels.service_name","metadata.system_labels.top_level_controller_type","metadata.system_labels.top_level_controller_name","metadata.system_labels.container_image"],Oe="select_slo_burn_rate",je=[{label:"SLI Value",value:"select_slo_health"},{label:"SLO Compliance",value:"select_slo_compliance"},{label:"SLO Error Budget Remaining",value:"select_slo_budget_fraction"},{label:"SLO Burn Rate",value:Oe}],Ee=[{label:"Builder",value:z.TIME_SERIES_LIST},{label:"MQL",value:z.TIME_SERIES_QUERY},{label:"Service Level Objectives (SLO)",value:z.SLO},{label:"PromQL",value:z.PROMQL}];function Se({refId:e,projectName:t,datasource:r,onChange:o,templateVariableOptions:i}){const[l,c]=(0,a.useState)([]);(0,a.useEffect)((()=>{r.getProjects().then((e=>c(e)))}),[r]);const u=(0,a.useMemo)((()=>[{label:"Template Variables",options:i},...l]),[l,i]);return(0,n.jsx)(ce,{label:"Project",children:(0,n.jsx)(s.Select,{width:"auto",allowCustomValue:!0,formatCreateLabel:e=>`Use project: ${e}`,onChange:({value:e})=>o(e),options:u,value:{value:t,label:t},placeholder:"Select Project",inputId:`${e}-project`})})}const Te=({children:e})=>i().createElement($,{gap:1},e);function Pe(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function xe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Ie=t=>(0,e.uniqBy)(t,"service"),we=(e,t)=>e.filter((e=>e.service===t)),Ne=(e,t,r,n)=>{const o=we(e,n).map((e=>({value:e.type,name:e.displayName}))),a=o.some((e=>e.value===r)),i=o.length?o[0].value:"";return{metricTypes:o,selectedMetricType:a?t:i}},De=(e,t,r)=>(r&&r===H.Rate&&(t=X.GAUGE),e?fe.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[]),Le=(e,t)=>t?me.filter((r=>-1!==r.valueTypes.indexOf(e)&&-1!==r.metricKinds.indexOf(t))):[],_e=(Ce=function*(e,t,r){const n=yield e.getLabels(t,"handleLabelKeysQuery",r);return[...Object.keys(n),...ge]},Ae=function(){var e=this,t=arguments;return new Promise((function(r,n){var o=Ce.apply(e,t);function a(e){Pe(o,r,n,a,i,"next",e)}function i(e){Pe(o,r,n,a,i,"throw",e)}a(void 0)}))},function(e,t,r){return Ae.apply(this,arguments)});var Ce,Ae;const Re=(e=Z.DOUBLE,t=X.GAUGE,n=ee.ALIGN_MEAN,o)=>{const a=(0,r.getTemplateSrv)(),i=De(e,t,o).map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){xe(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r}));return i.some((e=>e.value===a.replace(n)))||(n=i.length>0?i[0].value:ee.ALIGN_MEAN),{alignOptions:i,perSeriesAligner:n}},Ue=t=>{const r=t.reduce(((t,r)=>{const n=r.split(".").map(e.startCase),o=(2===n.length?n:(0,e.initial)(n)).join(" "),a={value:r,label:r};return t[o]?t[o]=[...t[o],a]:t[o]=[a],t}),{});return Object.entries(r).map((([e,t])=>({label:e,options:t,expanded:!0})),[])},Me=(e,r)=>{const{perSeriesAligner:n,alignmentPeriod:o}=e;if(!o||!n)return"";const a=fe.find((e=>e.value===r.templateSrv.replace(n))),i=parseInt(o,10);var l;return`${t.rangeUtil.secondsToHms(i)} interval (${null!==(l=null==a?void 0:a.text)&&void 0!==l?l:""})`},ke=e=>{var t,r;const n=null==e||null===(t=e.filters)||void 0===t?void 0:t.findIndex((e=>"metric.type"===e));return(null==e||null===(r=e.filters)||void 0===r?void 0:r[n+2])||""},Ge=(e,t)=>{var r;if(!e.filters)return e.filters=["metric.type","=",t],e;const n=null==e||null===(r=e.filters)||void 0===r?void 0:r.findIndex((e=>"metric.type"===e));return-1===n?e.filters.push("metric.type","=",t):e.filters[n+2]=t,e};function Qe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const qe=e=>{const t=Be(e),r=Fe(t,e);return(0,n.jsx)(ce,{label:"Group by function","data-testid":"cloud-monitoring-aggregation",children:(0,n.jsx)(s.Select,{width:"auto",onChange:({value:t})=>e.onChange(t),value:r,options:[{label:"Template Variables",options:e.templateVariableOptions},{label:"Aggregations",expanded:!0,options:t}],placeholder:"Select Reducer",inputId:`${e.refId}-group-by-function`,menuPlacement:"top"})})},Be=({metricDescriptor:e})=>{const t=null==e?void 0:e.valueType,r=null==e?void 0:e.metricKind;return(0,a.useMemo)((()=>t&&r?Le(t,r).map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Qe(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r})):[]),[t,r])},Fe=(e,t)=>(0,a.useMemo)((()=>[...e,...t.templateVariableOptions].find((e=>e.value===t.crossSeriesReducer))),[e,t.crossSeriesReducer,t.templateVariableOptions]);function Ve(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ve(e,t,r[t])}))}return e}function $e(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Ye=({refId:e,labels:t=[],query:r,onChange:o,variableOptionGroup:i,metricDescriptor:l})=>{const c=(0,a.useMemo)((()=>[i,...Ue([...t,...ge])]),[t,i]);var u,p;return(0,n.jsxs)(Te,{children:[(0,n.jsx)(ce,{label:"Group by",tooltip:"You can reduce the amount of data returned for a metric by combining different time series. To combine multiple time series, you can specify a grouping and a function. Grouping is done on the basis of labels. The grouping function is used to combine the time series in the group into a single time series.",children:(0,n.jsx)(s.MultiSelect,{allowCustomValue:!0,inputId:`${e}-group-by`,width:"auto",placeholder:"Choose label",options:c,value:null!==(u=r.groupBys)&&void 0!==u?u:[],onChange:e=>{o($e(Ke({},r),{groupBys:e.map((e=>e.value))}))},menuPlacement:"top"})}),(0,n.jsx)(qe,{metricDescriptor:l,templateVariableOptions:i.options,crossSeriesReducer:r.crossSeriesReducer,groupBys:null!==(p=r.groupBys)&&void 0!==p?p:[],onChange:e=>o($e(Ke({},r),{crossSeriesReducer:e})),refId:e})]})};function Je(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const We=({inputId:e,query:t,templateVariableOptions:r,onChange:o,metricDescriptor:i,preprocessor:l})=>{const{perSeriesAligner:c}=t;let{valueType:u,metricKind:p}=i||{};const{perSeriesAligner:d,alignOptions:y}=(0,a.useMemo)((()=>Re(u,p,c,l)),[u,p,c,l]);return(0,n.jsx)(s.Select,{onChange:({value:e})=>{return o((r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Je(e,t,r[t])}))}return e}({},t),n=null!=(n={perSeriesAligner:e})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})),r));var r,n},value:[...y,...r].find((e=>e.value===d)),options:[{label:"Template Variables",options:r},{label:"Alignment options",expanded:!0,options:y}],placeholder:"Select Alignment",inputId:e,menuPlacement:"top"})};function ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function He({inputId:e,templateVariableOptions:t,onChange:r,current:o,disabled:i,aligmentPeriods:l}){const c=(0,a.useMemo)((()=>l.map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){ze(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r}))),[l]),u=(0,a.useMemo)((()=>c.filter((e=>!e.hidden))),[c]);return(0,n.jsx)(s.Select,{width:"auto",onChange:({value:e})=>r(e),value:[...c,...t].find((e=>e.value===o)),options:[{label:"Template Variables",options:t},{label:"Aggregations",expanded:!0,options:u}],placeholder:"Select Period",inputId:e,disabled:i,allowCustomValue:!0,menuPlacement:"top"})}function Xe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Xe(e,t,r[t])}))}return e}const et=({refId:e,templateVariableOptions:t,onChange:r,query:o,customMetaData:i,datasource:l,metricDescriptor:s,preprocessor:c})=>{const u=(0,a.useMemo)((()=>Me(i,l)),[i,l]);return(0,n.jsxs)(Te,{children:[(0,n.jsx)(ce,{label:"Alignment function",tooltip:"The process of alignment consists of collecting all data points received in a fixed length of time, applying a function to combine those data points, and assigning a timestamp to the result.",children:(0,n.jsx)(We,{inputId:`${e}-alignment-function`,templateVariableOptions:t,query:o,onChange:e=>r(Ze({},o,e)),metricDescriptor:s,preprocessor:c})}),(0,n.jsx)(ce,{label:"Alignment period",tooltip:u,children:(0,n.jsx)(He,{inputId:`${e}-alignment-period`,templateVariableOptions:t,current:o.alignmentPeriod,onChange:e=>{return r((t=Ze({},o),n=null!=(n={alignmentPeriod:e})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})),t));var t,n},aligmentPeriods:be})})]})};var tt=Object.defineProperty,rt=Object.defineProperties,nt=Object.getOwnPropertyDescriptors,ot=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,it=Object.prototype.propertyIsEnumerable,lt=(e,t,r)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;const st=e=>{var t=e,{className:r}=t,n=((e,t)=>{var r={};for(var n in e)at.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&ot)for(var n of ot(e))t.indexOf(n)<0&&it.call(e,n)&&(r[n]=e[n]);return r})(t,["className"]);const a=(0,s.useStyles2)(ct);return i().createElement(s.Button,(l=((e,t)=>{for(var r in t||(t={}))at.call(t,r)&&lt(e,r,t[r]);if(ot)for(var r of ot(t))it.call(t,r)&&lt(e,r,t[r]);return e})({},n),c={className:(0,o.cx)(r,a.button)},rt(l,nt(c))));var l,c},ct=e=>({button:(0,o.css)({paddingLeft:e.spacing(1.5),paddingRight:e.spacing(1.5)})}),ut=i().forwardRef((function({items:e,renderItem:t,onChange:r},n){return i().createElement($,null,e.map(((n,o)=>i().createElement("div",{key:o},t(n,(t=>((t,n)=>{const o=[...e];o[t]=n,r(o)})(o,t)),(()=>(t=>{const n=[...e];n.splice(t,1),r(n)})(o)))))),i().createElement(s.Button,{ref:n,onClick:()=>{const t=[...e,{}];r(t)},variant:"secondary",size:"md",icon:"plus","aria-label":"Add",type:"button"}))})),pt="=",dt="AND",yt=["=","!=","=~","!=~"].map(t.toOption),ft=["metric.type"],mt=({labels:r={},filters:o,onChange:i,variableOptionGroup:l})=>{const c=(t=>(0,e.chunk)(t,4).map((([e,t,r,n="AND"])=>({key:e,operator:t,value:r,condition:n}))))(o),u=c.filter((({key:e})=>!ft.includes(e))),p=c.filter((({key:e})=>ft.includes(e))),d=(0,a.useMemo)((()=>[l,...Ue(Object.keys(r))]),[r,l]),y=({key:e="",value:n=""})=>{d.some((t=>t.options?d.some((t=>t.label===e)):t.label===e))||d.push({label:e,value:e});const o=r.hasOwnProperty(e)?[l,...r[e].map(t.toOption)]:[l];return o.some((e=>e.label===n))||o.push({label:n,value:n}),{options:d,valueOptions:o}};return(0,n.jsx)(de,{children:(0,n.jsx)(ce,{label:"Filter",tooltip:"To reduce the amount of data charted, apply a filter. A filter has three components: a label, a comparison, and a value. The comparison can be an equality, inequality, or regular expression.",children:(0,n.jsx)(ut,{items:u,renderItem:(e,t,r)=>{const{key:o="",operator:a=pt,value:i="",condition:l=dt}=e,{options:c,valueOptions:u}=y(e);return(0,n.jsxs)(s.HorizontalGroup,{spacing:"xs",width:"auto",children:[(0,n.jsx)(s.Select,{"aria-label":"Filter label key",formatCreateLabel:e=>`Use label key: ${e}`,allowCustomValue:!0,value:o,options:c,onChange:({value:e=""})=>t({key:e,operator:a,value:i,condition:l})}),(0,n.jsx)(s.Select,{value:a,options:yt,onChange:({value:e=pt})=>t({key:o,operator:e,value:i,condition:l})}),(0,n.jsx)(s.Select,{"aria-label":"Filter label value",placeholder:"add filter value",formatCreateLabel:e=>`Use label value: ${e}`,allowCustomValue:!0,value:i,options:u,onChange:({value:e=""})=>t({key:o,operator:a,value:e,condition:l})}),(0,n.jsx)(st,{"aria-label":"Remove",icon:"times",variant:"secondary",onClick:r,type:"button"})]})},onChange:e=>{const t=e.concat(p).map((({key:e,operator:t,value:r,condition:n})=>({key:e||"",operator:t||pt,value:r||"",condition:n||dt})));i((e=>e.flatMap((({key:e,operator:t,value:r,condition:n})=>[e,t,r,n])).slice(0,-1))(t))}})})})},bt=()=>(0,n.jsx)(s.Alert,{severity:"info",title:"Annotation Query Format",children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{children:["An annotation is an event that is overlaid on top of graphs. Annotation rendering is expensive so it is important to limit the number of rows returned."," "]}),(0,n.jsx)("p",{children:"The Title and Text fields support templating and can use data returned from the query. For example, the Title field could have the following text:"}),(0,n.jsxs)("code",{children:["{{metric.type}}"," has value: ","{{metric.value}}"]}),(0,n.jsxs)("p",{children:["Example Result: ",(0,n.jsx)("code",{children:"monitoring.googleapis.com/uptime_check/http_status has this value: 502"})]}),(0,n.jsx)("span",{children:"Patterns:"}),(0,n.jsxs)("p",{children:[(0,n.jsx)("code",{children:"{{metric.value}}"})," = value of the metric/point"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("code",{children:"{{metric.type}}"})," = metric type e.g. compute.googleapis.com/instance/cpu/usage_time"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("code",{children:"{{metric.name}}"})," = name part of metric e.g. instance/cpu/usage_time"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("code",{children:"{{metric.service}}"})," = service part of metric e.g. compute"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("code",{children:"{{metric.label.label_name}}"})," = Metric label metadata e.g. metric.label.instance_name"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("code",{children:"{{resource.label.label_name}}"})," = Resource label metadata e.g. resource.label.zone"]})]})});function vt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ht=({refId:e,current:t,templateVariableOptions:r,onChange:o})=>{const a=he.map((e=>{return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){vt(e,t,r[t])}))}return e}({},e),r=null!=(r={label:e.text})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r}));t&&!a.find((e=>e.value===t))&&a.push({label:t,text:t,value:t,hidden:!1});const i=a.filter((e=>!e.hidden));return(0,n.jsx)(ce,{label:"Lookback period",htmlFor:`${e}-lookback-period`,children:(0,n.jsx)(s.Select,{inputId:`${e}-lookback-period`,width:"auto",allowCustomValue:!0,value:[...a,...r].find((e=>e.value===t)),options:[{label:"Template Variables",options:r},{label:"Predefined periods",expanded:!0,options:i}],onChange:({value:e})=>o(e)})})};function gt(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function Ot(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const jt=({refId:e,query:t,templateVariableOptions:r,onChange:o,datasource:i})=>{const[l,c]=(0,a.useState)([]),{projectName:u,serviceId:p}=t;return(0,a.useEffect)((()=>{u&&p&&i.getServiceLevelObjectives(u,p).then((e=>{c([{label:"Template Variables",options:r},...e])}))}),[i,u,p,r]),(0,n.jsx)(ce,{label:"SLO",children:(0,n.jsx)(s.Select,{inputId:`${e}-slo`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.sloId)&&{value:null==t?void 0:t.sloId,label:(null==t?void 0:t.sloName)||(null==t?void 0:t.sloId)},placeholder:"Select SLO",options:l,onChange:function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){gt(a,n,o,i,l,"next",e)}function l(e){gt(a,n,o,i,l,"throw",e)}i(void 0)}))}}((function*({value:e="",label:r=""}){const n=(yield i.getServiceLevelObjectives(u,p)).find((({value:t})=>t===i.templateSrv.replace(e)));var a,l;o((a=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ot(e,t,r[t])}))}return e}({},t),l=null!=(l={sloId:e,sloName:r,goal:null==n?void 0:n.goal})?l:{},Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(l)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(l)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(l,e))})),a))}));return function(t){return e.apply(this,arguments)}}()})})};function Et(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const St=({refId:e,query:t,templateVariableOptions:r,onChange:o,datasource:a})=>(0,n.jsx)(ce,{label:"Selector",htmlFor:`${e}-slo-selector`,children:(0,n.jsx)(s.Select,{inputId:`${e}-slo-selector`,width:"auto",allowCustomValue:!0,value:[...je,...r].find((e=>{var r;return null!==(r=e.value===(null==t?void 0:t.selectorName))&&void 0!==r?r:""})),options:[{label:"Template Variables",options:r},...je],onChange:({value:e})=>{return o((r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Et(e,t,r[t])}))}return e}({},t),n=null!=(n={selectorName:null!=e?e:""})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})),r));var r,n}})});function Tt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Pt=({refId:e,query:t,templateVariableOptions:r,onChange:o,datasource:i})=>{const[l,c]=(0,a.useState)([]),{projectName:u}=t;return(0,a.useEffect)((()=>{u&&i.getSLOServices(u).then((e=>{c([{label:"Template Variables",options:r},...e])}))}),[i,u,r]),(0,n.jsx)(ce,{label:"Service",children:(0,n.jsx)(s.Select,{inputId:`${e}-slo-service`,width:"auto",allowCustomValue:!0,value:(null==t?void 0:t.serviceId)&&{value:null==t?void 0:t.serviceId,label:(null==t?void 0:t.serviceName)||(null==t?void 0:t.serviceId)},placeholder:"Select service",options:l,onChange:({value:e="",label:r=""})=>{return o((n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Tt(e,t,r[t])}))}return e}({},t),a=null!=(a={serviceId:e,serviceName:r,sloId:""})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n));var n,a}})})};function xt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function It(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){xt(e,t,r[t])}))}return e}function wt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Nt({refId:e,query:t,datasource:r,onChange:o,variableOptionGroup:i,customMetaData:l,aliasBy:s,onChangeAliasBy:c}){const u=(0,a.useMemo)((()=>Me(l,r)),[l,r]);return(0,n.jsx)("span",{"data-testid":W.components.queryEditor.sloQueryEditor.container.input,children:(0,n.jsxs)(de,{children:[(0,n.jsx)(Se,{refId:e,templateVariableOptions:i.options,projectName:t.projectName,datasource:r,onChange:e=>o(wt(It({},t),{projectName:e}))}),(0,n.jsx)(Pt,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:o}),(0,n.jsx)(jt,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:o}),(0,n.jsx)(St,{refId:e,datasource:r,templateVariableOptions:i.options,query:t,onChange:o}),t.selectorName===Oe&&(0,n.jsx)(ht,{refId:e,onChange:e=>o(wt(It({},t),{lookbackPeriod:e})),current:t.lookbackPeriod,templateVariableOptions:i.options}),(0,n.jsx)(Te,{children:(0,n.jsx)(ce,{label:"Alignment period",tooltip:u,children:(0,n.jsx)(He,{inputId:`${e}-alignment-period`,templateVariableOptions:i.options,current:t.alignmentPeriod,onChange:e=>o(wt(It({},t),{alignmentPeriod:e})),aligmentPeriods:be})})}),(0,n.jsx)(pe,{refId:e,value:s,onChange:c})]})})}function Dt({query:e,onChange:t,onRunQuery:r}){return(0,n.jsx)("span",{"data-testid":W.components.queryEditor.mqlMetricsQueryEditor.container.input,children:(0,n.jsx)(s.TextArea,{name:"Query",className:"slate-query-field",value:e,rows:10,placeholder:"Enter a Cloud Monitoring MQL query (Run with Shift+Enter)",onBlur:r,onChange:e=>t(e.currentTarget.value),onKeyDown:e=>{"Enter"===e.key&&(e.shiftKey||e.ctrlKey)&&(e.preventDefault(),r())}})})}const Lt=({label:e,onChange:t,value:r,options:o,allowCustomValue:a=!1})=>(0,n.jsx)(s.Field,{label:e,children:(0,n.jsx)(s.Select,{width:25,allowCustomValue:a,value:r,onChange:({value:e})=>t(e),options:o})});var _t=c(635),Ct=c.n(_t);function At(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Rt={label:"None",value:H.None},Ut=({query:e,metricDescriptor:t,onChange:r})=>{const o=Mt(t);var a;return(0,n.jsx)(ce,{label:"Pre-processing",tooltip:"Preprocessing options are displayed when the selected metric has a metric kind of delta or cumulative. The specific options available are determined by the metric's value type. If you select 'Rate', data points are aligned and converted to a rate per time series. If you select 'Delta', data points are aligned by their delta (difference) per time series",children:(0,n.jsx)(s.RadioButtonGroup,{onChange:n=>{const{perSeriesAligner:o}=e,{valueType:a,metricKind:i}=null!=t?t:{},{perSeriesAligner:l}=Re(a,i,o,n);var s,c;r((s=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){At(e,t,r[t])}))}return e}({},e),c=null!=(c={preprocessor:n,perSeriesAligner:l})?c:{},Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(c)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(c)).forEach((function(e){Object.defineProperty(s,e,Object.getOwnPropertyDescriptor(c,e))})),s))},value:null!==(a=e.preprocessor)&&void 0!==a?a:H.None,options:o})})},Mt=e=>{const t=null==e?void 0:e.metricKind,r=null==e?void 0:e.valueType;return(0,a.useMemo)((()=>{if(!t||t===X.GAUGE||r===Z.DISTRIBUTION)return[Rt];const e=[Rt,{label:"Rate",value:H.Rate,description:"Data points are aligned and converted to a rate per time series"}];return t===X.CUMULATIVE?[...e,{label:"Delta",value:H.Delta,description:"Data points are aligned by their delta (difference) per time series"}]:e}),[t,r])};function kt(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function Gt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){kt(a,n,o,i,l,"next",e)}function l(e){kt(a,n,o,i,l,"throw",e)}i(void 0)}))}}function Qt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Qt(e,t,r[t])}))}return e}function Bt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Ft({refId:t,onChange:o,datasource:i,query:l,variableOptionGroup:c,customMetaData:u,aliasBy:p,onChangeAliasBy:d,range:y}){const[f,m]=(0,a.useState)({}),[b,v]=(0,a.useState)([]),[h,g]=(0,a.useState)(),[O,j]=(0,a.useState)([]),[E,S]=(0,a.useState)([]),[T,P]=(0,a.useState)(""),[x,I]=(0,a.useState)(qt({},y));var w;w=y,null===x||x.raw.from.toString()===w.raw.from.toString()&&x.raw.to.toString()===w.raw.to.toString()||I(qt({},w));const N=(0,s.useTheme2)(),D=(0,s.getSelectStyles)(N),L=(0,s.useStyles2)(Vt),{projectName:_,groupBys:C,crossSeriesReducer:A}=l,R=ke(l),{templateSrv:U}=i,M=(0,a.useCallback)(((e,t)=>e.find((e=>e.type===U.replace(t)))),[U]);(0,a.useEffect)((()=>{_&&R&&i.getLabels(R,t,_,{groupBys:C,crossSeriesReducer:A},x).then((e=>m(e)))}),[i,C,R,_,t,A,x]),(0,a.useEffect)((()=>{const e=function(){var e=Gt((function*(){if(_){const e=yield i.getMetricTypes(_);(0,r.reportInteraction)("cloud-monitoring-metric-descriptors-loaded",{count:e.length});const t=k(e);v(e),S(t)}}));return function(){return e.apply(this,arguments)}}();e()}),[i,_,L,D.optionDescription]),(0,a.useEffect)((()=>{const e=(e=>{const t=M(e,R);return t?e.filter((e=>e.service===t.service)).map((e=>({service:e.service,value:e.type,label:e.displayName,component:function(){return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:L,children:e.type}),(0,n.jsx)("div",{className:D.optionDescription,children:e.description})]})}}))):[]})(b),t=e.length>0?e[0].service:"",r=M(b,R);g(r),j(e),P(t)}),[b,M,R,L,D.optionDescription]);const k=t=>{const r=t.map((t=>({value:t.service,label:(0,e.startCase)(t.serviceShortName)})));return r.length>0?(0,e.uniqBy)(r,(e=>e.value)):[]},G=function(){var e=Gt((function*(e){const t=(yield i.filterMetricsByType(_,T)).filter((t=>t.type.includes(e.toLowerCase()))).map((e=>({value:e.type,label:e.displayName,component:function(){return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:L,children:e.type}),(0,n.jsx)("div",{className:D.optionDescription,children:e.description})]})}})));return[{label:"Template Variables",options:c.options},...t]}));return function(t){return e.apply(this,arguments)}}(),Q=Ct()(G,400),q=({value:e})=>{const t=M(b,e);g(t);const{metricKind:r,valueType:n}=t,a=r===X.GAUGE||n===Z.DISTRIBUTION?H.None:H.Rate,{perSeriesAligner:s}=Re(n,r,l.perSeriesAligner,a);Object.assign(l,Bt(qt({},zt(i)),{projectName:l.projectName,filters:l.filters})),o(Bt(qt({},Ge(Bt(qt({},l),{perSeriesAligner:s}),e)),{preprocessor:a}))};return(0,n.jsxs)("span",{"data-testid":W.components.queryEditor.visualMetricsQueryEditor.container.input,children:[(0,n.jsx)(de,{children:(0,n.jsxs)(Te,{children:[(0,n.jsx)(Se,{refId:t,templateVariableOptions:c.options,projectName:_,datasource:i,onChange:e=>{o(Bt(qt({},l),{projectName:e}))}}),(0,n.jsx)(ce,{label:"Service",width:"auto",children:(0,n.jsx)(s.Select,{width:"auto",onChange:({value:e})=>{const t=b.filter((t=>t.service===U.replace(e))).map((e=>({service:e.service,value:e.type,label:e.displayName,description:e.description})));l.filters=[],t.length>0&&!t.some((e=>e.value===U.replace(R)))?(q(t[0]),P(e),j(t)):(P(e),j(t))},isLoading:0===E.length,value:[...E,...c.options].find((e=>e.value===T)),options:[{label:"Template Variables",options:c.options},...E],placeholder:"Select Services",inputId:`${t}-service`})}),(0,n.jsx)(ce,{label:"Metric name",width:"auto",htmlFor:`${t}-select-metric`,children:(0,n.jsx)("span",{title:""===T?"Select a service first":"Type to search metrics",children:(0,n.jsx)(s.AsyncSelect,{width:"auto",onChange:q,value:[...O,...c.options].find((e=>e.value===R)),loadOptions:Q,defaultOptions:[{label:"Template Variables",options:c.options},...O.slice(0,100)],placeholder:"Select Metric",inputId:`${t}-select-metric`,disabled:""===T})})})]})}),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(mt,{labels:f,filters:l.filters,onChange:e=>o(Bt(qt({},l),{filters:e})),variableOptionGroup:c}),(0,n.jsxs)(de,{children:[(0,n.jsx)(Ut,{metricDescriptor:h,query:l,onChange:o}),(0,n.jsx)(Ye,{refId:t,labels:Object.keys(f),query:l,onChange:o,variableOptionGroup:c,metricDescriptor:h}),(0,n.jsx)(et,{refId:t,datasource:i,templateVariableOptions:c.options,query:l,customMetaData:u,onChange:o,metricDescriptor:h,preprocessor:l.preprocessor}),(0,n.jsx)(pe,{refId:t,value:p,onChange:d})]})]})]})}const Vt=e=>o.css`
  label: grafana-select-option-description;
  font-weight: normal;
  font-style: italic;
  color: ${e.colors.text.secondary};
`,Kt=a.memo(Ft),$t=({refId:e,onChange:t,graphPeriod:r,variableOptionGroup:o})=>(0,n.jsx)(de,{children:(0,n.jsx)(ce,{label:"Graph period",htmlFor:`${e}-graph-period`,tooltip:(0,n.jsxs)(n.Fragment,{children:["Set ",(0,n.jsx)("code",{children:"graph_period"})," which forces a preferred period between points. Automatically set to the current interval if left blank."]}),children:(0,n.jsxs)(s.HorizontalGroup,{children:[(0,n.jsx)(s.Switch,{"data-testid":`${e}-switch-graph-period`,value:"disabled"!==r,onChange:e=>t(e.currentTarget.checked?"":"disabled")}),(0,n.jsx)(He,{inputId:`${e}-graph-period`,templateVariableOptions:o.options,current:r,onChange:t,disabled:"disabled"===r,aligmentPeriods:ve})]})})});function Yt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Yt(e,t,r[t])}))}return e}function Wt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const zt=e=>({projectName:e.getDefaultProject(),crossSeriesReducer:"REDUCE_NONE",alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:ee.ALIGN_MEAN,groupBys:[],filters:[]}),Ht=e=>({projectName:e.getDefaultProject(),query:""});function Xt({refId:e,query:t,datasource:r,onChange:o,onRunQuery:i,customMetaData:l,variableOptionGroup:s,range:c}){const u=(0,a.useCallback)((e=>{let r=!0;if((null==e?void 0:e.filters)&&e.filters.length>0)for(const t of e.filters)if(""===t){r=!1;break}o(Wt(Jt({},t),{timeSeriesList:e})),r&&i()}),[o,i,t]),p=(0,a.useCallback)((e=>{o(Wt(Jt({},t),{timeSeriesQuery:e})),i()}),[o,i,t]);return(0,a.useEffect)((()=>{t.queryType!==z.TIME_SERIES_LIST||t.timeSeriesList||o({refId:t.refId,datasource:t.datasource,queryType:z.TIME_SERIES_LIST,timeSeriesList:zt(r),aliasBy:t.aliasBy}),t.queryType!==z.TIME_SERIES_QUERY||t.timeSeriesQuery||o({refId:t.refId,datasource:t.datasource,queryType:z.TIME_SERIES_QUERY,timeSeriesQuery:Ht(r),aliasBy:t.aliasBy})}),[o,t,r]),(0,n.jsxs)(J,{children:[(t.queryType===z.ANNOTATION||t.queryType===z.TIME_SERIES_LIST)&&t.timeSeriesList&&(0,n.jsx)(Kt,{refId:e,variableOptionGroup:s,customMetaData:l,onChange:u,datasource:r,query:t.timeSeriesList,aliasBy:t.aliasBy,onChangeAliasBy:e=>o(Wt(Jt({},t),{aliasBy:e})),range:c}),t.queryType===z.TIME_SERIES_QUERY&&t.timeSeriesQuery&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)($,{gap:1,direction:"row",children:[(0,n.jsx)(Se,{refId:e,datasource:r,onChange:e=>p(Wt(Jt({},t.timeSeriesQuery),{projectName:e})),templateVariableOptions:s.options,projectName:t.timeSeriesQuery.projectName}),(0,n.jsx)(pe,{refId:e,value:t.aliasBy,onChange:e=>o(Wt(Jt({},t),{aliasBy:e}))})]}),(0,n.jsx)(Dt,{onChange:e=>p(Wt(Jt({},t.timeSeriesQuery),{query:e})),onRunQuery:i,query:t.timeSeriesQuery.query}),(0,n.jsx)($t,{onChange:e=>p(Wt(Jt({},t.timeSeriesQuery),{graphPeriod:e})),graphPeriod:t.timeSeriesQuery.graphPeriod,refId:e,variableOptionGroup:s})]})]})}const Zt=a.memo(Xt);function er(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){er(e,t,r[t])}))}return e}function rr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function nr({refId:e,query:t,datasource:r,onChange:o,variableOptionGroup:a,onRunQuery:i}){function l(e){"Enter"===e.key&&e.shiftKey&&(i(),e.preventDefault(),e.stopPropagation())}var c;return(0,n.jsx)("span",{"data-testid":W.components.queryEditor.promQlQueryEditor.container.input,children:(0,n.jsxs)(de,{children:[(0,n.jsx)(Se,{refId:e,templateVariableOptions:a.options,projectName:t.projectName,datasource:r,onChange:e=>o(rr(tr({},t),{projectName:e}))}),(0,n.jsx)(s.TextArea,{name:"Query",className:"slate-query-field",value:t.expr,rows:10,placeholder:"Enter a Cloud Monitoring Prometheus query (Run with Shift+Enter)",onBlur:i,onKeyDown:l,onChange:e=>o(rr(tr({},t),{expr:e.currentTarget.value}))}),(0,n.jsx)(ce,{label:"Min step",tooltip:"Time units and built-in variables can be used here, for example: $__interval, $__rate_interval, 5s, 1m, 3h, 1d, 1y (Default if no unit is specified: 10s)",children:(0,n.jsx)(s.Input,{type:"string",placeholder:"auto",onChange:e=>o(rr(tr({},t),{step:e.currentTarget.value})),onKeyDown:l,value:null!==(c=t.step)&&void 0!==c?c:""})})]})})}const or=({children:e})=>{const t=(0,s.useStyles2)(ar);return i().createElement("div",{className:t.root},e)},ar=e=>({root:(0,o.css)({display:"flex",flexWrap:"wrap",alignItems:"center",gap:e.spacing(3),minHeight:e.spacing(4)})});var ir=Object.defineProperty,lr=Object.defineProperties,sr=Object.getOwnPropertyDescriptors,cr=Object.getOwnPropertySymbols,ur=Object.prototype.hasOwnProperty,pr=Object.prototype.propertyIsEnumerable,dr=(e,t,r)=>t in e?ir(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yr=(e,t)=>{for(var r in t||(t={}))ur.call(t,r)&&dr(e,r,t[r]);if(cr)for(var r of cr(t))pr.call(t,r)&&dr(e,r,t[r]);return e},fr=(e,t)=>lr(e,sr(t));function mr(e){var t=e,{label:r}=t,n=((e,t)=>{var r={};for(var n in e)ur.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&cr)for(var n of cr(e))t.indexOf(n)<0&&pr.call(e,n)&&(r[n]=e[n]);return r})(t,["label"]);const o=(0,s.useStyles2)(hr),[l]=(0,a.useState)((()=>Math.random().toString(16).slice(2))),c={SelectContainer:br,ValueContainer:vr,SingleValue:vr};return i().createElement("div",{className:o.root},r&&i().createElement("label",{className:o.label,htmlFor:l},r,":"," "),i().createElement(s.Select,fr(yr({openMenuOnFocus:!0,inputId:l},n),{components:c})))}const br=e=>{const{children:t}=e,r=(0,s.useStyles2)(hr);return i().createElement(s.SelectContainer,fr(yr({},e),{className:(0,o.cx)(e.className,r.container)}),t)},vr=e=>{const{className:t,children:r}=e,n=(0,s.useStyles2)(hr);return i().createElement("div",{className:(0,o.cx)(t,n.valueContainer)},r)},hr=e=>({root:(0,o.css)({display:"flex",fontSize:12,alignItems:"center"}),label:(0,o.css)({color:e.colors.text.secondary,whiteSpace:"nowrap"}),container:(0,o.css)({background:"none",borderColor:"transparent"}),valueContainer:(0,o.css)({display:"flex",alignItems:"center",flex:"initial",color:e.colors.text.secondary,fontSize:12})}),gr=({grow:e,shrink:t})=>i().createElement("div",{style:{display:"block",flexGrow:e,flexShrink:t}});function Or(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const jr=e=>{const{query:t,onChange:r,onRunQuery:o}=e,{queryType:a}=t;return(0,n.jsxs)(or,{children:[(0,n.jsx)(mr,{label:"Query type",options:Ee,value:a,onChange:({value:e})=>{var n,a;r((n=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Or(e,t,r[t])}))}return e}({},t),a=null!=(a={queryType:e})?a:{},Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))})),n)),o()}}),(0,n.jsx)(gr,{grow:1})]})};function Er(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Er(e,t,r[t])}))}return e}function Tr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}function Pr(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function xr(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Pr(a,n,o,i,l,"next",e)}function l(e){Pr(a,n,o,i,l,"throw",e)}i(void 0)}))}}function Ir(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wr(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Ir(e,t,r[t])}))}return e}function Nr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Dr extends a.PureComponent{componentDidMount(){var e=this;return xr((function*(){yield e.props.datasource.ensureGCEDefaultProject();const t=e.props.query.projectName||e.props.datasource.getDefaultProject(),n=yield e.props.datasource.getProjects(),o=yield e.props.datasource.getMetricTypes(e.props.query.projectName||e.props.datasource.getDefaultProject()),a=Ie(o).map((e=>({value:e.service,label:e.serviceShortName})));let i="";a.some((t=>t.value===(0,r.getTemplateSrv)().replace(e.state.selectedService)))?i=e.state.selectedService:a&&a.length>0&&(i=a[0].value);const{metricTypes:l,selectedMetricType:s}=Ne(o,e.state.selectedMetricType,(0,r.getTemplateSrv)().replace(e.state.selectedMetricType),(0,r.getTemplateSrv)().replace(i)),c=yield e.props.datasource.getSLOServices(t),u=Nr(wr({services:a,selectedService:i,metricTypes:l,selectedMetricType:s,metricDescriptors:o,projects:n},yield e.getLabels(s,t)),{sloServices:c,loading:!1,projectName:t});e.setState(u,(()=>e.onPropsChange()))}))()}onQueryTypeChange(e){var t=this;return xr((function*(){const r=wr({selectedQueryType:e},yield t.getLabels(t.state.selectedMetricType,t.state.projectName,e));t.setState(r)}))()}onProjectChange(e){var t=this;return xr((function*(){const n=yield t.props.datasource.getMetricTypes(e),o=yield t.getLabels(t.state.selectedMetricType,e),{metricTypes:a,selectedMetricType:i}=Ne(n,t.state.selectedMetricType,(0,r.getTemplateSrv)().replace(t.state.selectedMetricType),(0,r.getTemplateSrv)().replace(t.state.selectedService)),l=yield t.props.datasource.getSLOServices(e);t.setState(Nr(wr({},o),{metricTypes:a,selectedMetricType:i,metricDescriptors:n,projectName:e,sloServices:l}),(()=>t.onPropsChange()))}))()}onServiceChange(e){var t=this;return xr((function*(){const{metricTypes:n,selectedMetricType:o}=Ne(t.state.metricDescriptors,t.state.selectedMetricType,(0,r.getTemplateSrv)().replace(t.state.selectedMetricType),(0,r.getTemplateSrv)().replace(e)),a=wr({selectedService:e,metricTypes:n,selectedMetricType:o},yield t.getLabels(o,t.state.projectName));t.setState(a,(()=>t.onPropsChange()))}))()}onMetricTypeChange(e){var t=this;return xr((function*(){const n=wr({selectedMetricType:e},yield t.getLabels((0,r.getTemplateSrv)().replace(e),t.state.projectName));t.setState(n,(()=>t.onPropsChange()))}))()}onLabelKeyChange(e){this.setState({labelKey:e},(()=>this.onPropsChange()))}componentDidUpdate(e,t){const r=t.selectedQueryType!==this.state.selectedQueryType,n=this.state.selectedSLOService!==t.selectedSLOService;(r||n)&&this.onPropsChange()}getLabels(e,t,n=this.state.selectedQueryType){var o=this;return xr((function*(){let a={labels:o.state.labels,labelKey:o.state.labelKey};if(e&&n===te.LabelValues){const n=yield _e(o.props.datasource,e,t),i=n.some((e=>e===(0,r.getTemplateSrv)().replace(o.state.labelKey)))?o.state.labelKey:n[0];a={labels:n,labelKey:i}}return a}))()}renderQueryTypeSwitch(e){const t={label:"Template Variables",expanded:!1,options:(0,r.getTemplateSrv)().getVariables().map((e=>({value:`$${e.name}`,label:`$${e.name}`})))};switch(e){case te.MetricTypes:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Lt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,n.jsx)(Lt,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"})]});case te.LabelKeys:case te.LabelValues:case te.ResourceTypes:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Lt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,n.jsx)(Lt,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),(0,n.jsx)(Lt,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"}),e===te.LabelValues&&(0,n.jsx)(Lt,{value:this.state.labelKey,options:[t,...this.state.labels.map((e=>({value:e,label:e})))],onChange:e=>this.onLabelKeyChange(e),label:"Label Key"})]});case te.Aligners:case te.Aggregations:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Lt,{value:this.state.selectedService,options:[t,...this.state.services],onChange:e=>this.onServiceChange(e),label:"Service"}),(0,n.jsx)(Lt,{value:this.state.selectedMetricType,options:[t,...this.state.metricTypes.map((({value:e,name:t})=>({value:e,label:t})))],onChange:e=>this.onMetricTypeChange(e),label:"Metric Type"})]});case te.Services:case te.SLOServices:return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(Lt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"})});case te.SLO:return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Lt,{allowCustomValue:!0,value:this.state.projectName,options:[t,...this.state.projects],onChange:e=>this.onProjectChange(e),label:"Project"}),(0,n.jsx)(Lt,{value:this.state.selectedSLOService,options:[t,...this.state.sloServices],onChange:e=>{this.setState(Nr(wr({},this.state),{selectedSLOService:e}))},label:"SLO Service"})]});default:return""}}render(){return this.state.loading?(0,n.jsx)(Lt,{value:"loading",options:[{value:"loading",label:"Loading..."}],onChange:e=>null,label:"Query Type"}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Lt,{value:this.state.selectedQueryType,options:this.queryTypes,onChange:e=>this.onQueryTypeChange(e),label:"Query Type"}),this.renderQueryTypeSwitch(this.state.selectedQueryType)]})}constructor(e){super(e),Ir(this,"queryTypes",[{value:te.Projects,label:"Projects"},{value:te.Services,label:"Services"},{value:te.MetricTypes,label:"Metric Types"},{value:te.LabelKeys,label:"Label Keys"},{value:te.LabelValues,label:"Label Values"},{value:te.ResourceTypes,label:"Resource Types"},{value:te.Aggregations,label:"Aggregations"},{value:te.Aligners,label:"Aligners"},{value:te.AlignmentPeriods,label:"Alignment Periods"},{value:te.Selectors,label:"Selectors"},{value:te.SLOServices,label:"SLO Services"},{value:te.SLO,label:"Service Level Objectives (SLO)"}]),Ir(this,"defaults",{selectedQueryType:this.queryTypes[0].value,metricDescriptors:[],selectedService:"",selectedMetricType:"",labels:[],labelKey:"",metricTypes:[],services:[],sloServices:[],selectedSLOService:"",projects:[],projectName:"",loading:!0}),Ir(this,"onPropsChange",(()=>{const e=this.state,{metricDescriptors:t,labels:r,metricTypes:n,services:o}=e,a=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(e,["metricDescriptors","labels","metricTypes","services"]);this.props.onChange(Nr(wr({},a),{refId:"CloudMonitoringVariableQueryEditor-VariableQuery"}))})),this.state=Object.assign(this.defaults,this.props.query)}}var Lr=c(269);function _r(e){return"function"==typeof e}function Cr(e){return function(t){if(function(e){return _r(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var Ar=function(e,t){return Ar=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},Ar(e,t)};function Rr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}Ar(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function Ur(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(s){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,n=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(e){l=[6,e],n=0}finally{r=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}function Mr(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function kr(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function Gr(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}function Qr(e){return this instanceof Qr?(this.v=e,this):new Qr(e)}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var qr,Br=((qr=function(e){var t;t=this,Error.call(t),t.stack=(new Error).stack,this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),qr.prototype.constructor=qr,qr);function Fr(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var Vr=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,r,n,o;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var i=Mr(a),l=i.next();!l.done;l=i.next())l.value.remove(this)}catch(t){e={error:t}}finally{try{l&&!l.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}else a.remove(this);var s=this.initialTeardown;if(_r(s))try{s()}catch(e){o=e instanceof Br?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=Mr(c),p=u.next();!p.done;p=u.next()){var d=p.value;try{$r(d)}catch(e){o=null!=o?o:[],e instanceof Br?o=Gr(Gr([],kr(o)),kr(e.errors)):o.push(e)}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(o)throw new Br(o)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)$r(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&Fr(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&Fr(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}();function Kr(e){return e instanceof Vr||e&&"closed"in e&&_r(e.remove)&&_r(e.add)&&_r(e.unsubscribe)}function $r(e){_r(e)?e():e.unsubscribe()}Vr.EMPTY;var Yr={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Jr={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var o=Jr.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,Gr([e,t],kr(r))):setTimeout.apply(void 0,Gr([e,t],kr(r)))},clearTimeout:function(e){var t=Jr.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Wr(e){Jr.setTimeout((function(){var t=Yr.onUnhandledError;if(!t)throw e;t(e)}))}function zr(){}var Hr=Xr("C",void 0,void 0);function Xr(e,t,r){return{kind:e,value:t,error:r}}var Zr=null,en=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,Kr(t)&&t.add(r)):r.destination=sn,r}return Rr(t,e),t.create=function(e,t,r){return new on(e,t,r)},t.prototype.next=function(e){this.isStopped?ln(function(e){return Xr("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?ln(Xr("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?ln(Hr,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Vr),tn=Function.prototype.bind;function rn(e,t){return tn.call(e,t)}var nn=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){an(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){an(e)}else an(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){an(e)}},e}(),on=function(e){function t(t,r,n){var o,a,i=e.call(this)||this;return _r(t)||!t?o={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:i&&Yr.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return i.unsubscribe()},o={next:t.next&&rn(t.next,a),error:t.error&&rn(t.error,a),complete:t.complete&&rn(t.complete,a)}):o=t,i.destination=new nn(o),i}return Rr(t,e),t}(en);function an(e){var t;Yr.useDeprecatedSynchronousErrorHandling?(t=e,Yr.useDeprecatedSynchronousErrorHandling&&Zr&&(Zr.errorThrown=!0,Zr.error=t)):Wr(e)}function ln(e,t){var r=Yr.onStoppedNotification;r&&Jr.setTimeout((function(){return r(e,t)}))}var sn={closed:!0,next:zr,error:function(e){throw e},complete:zr};function cn(e,t,r,n,o){return new un(e,t,r,n,o)}var un=function(e){function t(t,r,n,o,a,i){var l=e.call(this,t)||this;return l.onFinalize=a,l.shouldUnsubscribe=i,l._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,l._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,l._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,l}return Rr(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(en);function pn(e,t){return Cr((function(r,n){var o=0;r.subscribe(cn(n,(function(r){n.next(e.call(t,r,o++))})))}))}var dn=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},yn="function"==typeof Symbol&&Symbol.observable||"@@observable";function fn(e){return e}var mn=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n,o=this,a=(n=e)&&n instanceof en||function(e){return e&&_r(e.next)&&_r(e.error)&&_r(e.complete)}(n)&&Kr(n)?e:new on(e,t,r);return function(e){if(Yr.useDeprecatedSynchronousErrorHandling){var t=!Zr;if(t&&(Zr={errorThrown:!1,error:null}),e(),t){var r=Zr,n=r.errorThrown,o=r.error;if(Zr=null,n)throw o}}else e()}((function(){var e=o,t=e.operator,r=e.source;a.add(t?t.call(a,r):r?o._subscribe(a):o._trySubscribe(a))})),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=bn(t))((function(t,n){var o=new on({next:function(t){try{e(t)}catch(e){n(e),o.unsubscribe()}},error:n,complete:t});r.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[yn]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?fn:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=bn(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function bn(e){var t;return null!==(t=null!=e?e:Yr.Promise)&&void 0!==t?t:Promise}var vn="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function hn(e){if(e instanceof mn)return e;if(null!=e){if(function(e){return _r(e[yn])}(e))return a=e,new mn((function(e){var t=a[yn]();if(_r(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(dn(e))return o=e,new mn((function(e){for(var t=0;t<o.length&&!e.closed;t++)e.next(o[t]);e.complete()}));if(_r(null==(n=e)?void 0:n.then))return r=e,new mn((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Wr)}));if(function(e){return Symbol.asyncIterator&&_r(null==e?void 0:e[Symbol.asyncIterator])}(e))return gn(e);if(function(e){return _r(null==e?void 0:e[vn])}(e))return t=e,new mn((function(e){var r,n;try{for(var o=Mr(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(e.next(i),e.closed)return}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}e.complete()}));if(function(e){return _r(null==e?void 0:e.getReader)}(e))return gn(function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,o=r.apply(e,t||[]),a=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",(function(e){return function(t){return Promise.resolve(t).then(e,c)}})),n[Symbol.asyncIterator]=function(){return this},n;function i(e,t){o[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||l(e,t)}))},t&&(n[e]=t(n[e])))}function l(e,t){try{(r=o[e](t)).value instanceof Qr?Promise.resolve(r.value.v).then(s,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}var r}function s(e){l("next",e)}function c(e){l("throw",e)}function u(e,t){e(t),a.shift(),a.length&&l(a[0][0],a[0][1])}}(this,arguments,(function(){var t,r,n;return Ur(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,Qr(t.read())];case 3:return r=o.sent(),n=r.value,r.done?[4,Qr(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,Qr(n)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}(e))}var t,r,n,o,a;throw function(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}(e)}function gn(e){return new mn((function(t){(function(e,t){var r,n,o,a,i,l,s,c;return i=this,l=void 0,c=function(){var i,l;return Ur(this,(function(s){switch(s.label){case 0:s.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Mr(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,o){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,o,(t=e[r](t)).done,t.value)}))}}}(e),s.label=1;case 1:return[4,r.next()];case 2:if((n=s.sent()).done)return[3,4];if(i=n.value,t.next(i),t.closed)return[2];s.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=s.sent(),o={error:l},[3,11];case 6:return s.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:s.sent(),s.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof s?o:new s((function(e){e(o)}))).then(r,n)}o((c=c.apply(i,l||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function On(e,t,r){return void 0===r&&(r=1/0),_r(t)?On((function(r,n){return pn((function(e,o){return t(r,e,n,o)}))(hn(e(r,n)))}),r):("number"==typeof t&&(r=t),Cr((function(t,n){return function(e,t,r,n,o,a,i,l){var s=[],c=0,u=0,p=!1,d=function(){!p||s.length||c||t.complete()},y=function(e){return c<n?f(e):s.push(e)},f=function(e){c++;var o=!1;hn(r(e,u++)).subscribe(cn(t,(function(e){t.next(e)}),(function(){o=!0}),void 0,(function(){if(o)try{c--;for(var e=function(){var e=s.shift();f(e)};s.length&&c<n;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(cn(t,y,(function(){p=!0,d()}))),function(){}}(t,n,e,r)})))}function jn(e,t,r){void 0===t&&(t=0),void 0===r&&(r=[]);var n=function(e,t){void 0===t&&(t=0);var r=(0,a.useRef)(!1),n=(0,a.useRef)(),o=(0,a.useRef)(e),i=(0,a.useCallback)((function(){return r.current}),[]),l=(0,a.useCallback)((function(){r.current=!1,n.current&&clearTimeout(n.current),n.current=setTimeout((function(){r.current=!0,o.current()}),t)}),[t]),s=(0,a.useCallback)((function(){r.current=null,n.current&&clearTimeout(n.current)}),[]);return(0,a.useEffect)((function(){o.current=e}),[e]),(0,a.useEffect)((function(){return l(),s}),[t]),[i,s,l]}(e,t),o=n[0],i=n[1],l=n[2];return(0,a.useEffect)(l,r),[o,i]}function En(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Sn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){En(e,t,r[t])}))}return e}function Tn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}const Pn=e=>{const{datasource:r,query:o,onRunQuery:i,data:l,onChange:c,range:u}=e,p=(null==l?void 0:l.series.length)?null==l?void 0:l.series[0].meta:{};var d;const y=null!==(d=null==p?void 0:p.custom)&&void 0!==d?d:{},f=Sn({},(e=>Tn(Sn({},zt(e)),{title:"",text:""}))(r),o.timeSeriesList),[m,b]=(0,a.useState)(f.title||""),[v,h]=(0,a.useState)(f.text||""),g={label:"Template Variables",options:r.getVariables().map(t.toOption)};return jn((()=>{c(Tn(Sn({},o),{timeSeriesList:Tn(Sn({},f),{title:m})}))}),1e3,[m,c]),jn((()=>{c(Tn(Sn({},o),{timeSeriesList:Tn(Sn({},f),{text:v})}))}),1e3,[v,c]),(0,a.useEffect)((()=>{o.queryType&&Object.values(z).includes(o.queryType)||c(Tn(Sn({},o),{queryType:z.TIME_SERIES_LIST}))})),(0,n.jsxs)(J,{children:[(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Zt,{refId:o.refId,variableOptionGroup:g,customMetaData:y,onChange:c,onRunQuery:i,datasource:r,query:o,range:u||(0,t.getDefaultTimeRange)()}),(0,n.jsx)(ce,{label:"Title",htmlFor:"annotation-query-title",children:(0,n.jsx)(s.Input,{id:"annotation-query-title",value:m,onChange:e=>{b(e.target.value)}})}),(0,n.jsx)(ce,{label:"Text",htmlFor:"annotation-query-text",children:(0,n.jsx)(s.Input,{id:"annotation-query-text",value:v,onChange:e=>{h(e.target.value)}})})]}),(0,n.jsx)(bt,{})]})};function xn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const In=e=>({prepareAnnotation:t=>{if(!(e=>{var t,r;return void 0!==(null===(t=e.target)||void 0===t?void 0:t.title)||void 0!==(null===(r=e.target)||void 0===r?void 0:r.text)})(t))return t;const{enable:r,name:n,iconColor:o}=t,{target:a}=t;return{datasource:t.datasource,enable:r,name:n,iconColor:o,target:{intervalMs:e.intervalMs,refId:(null==a?void 0:a.refId)||"annotationQuery",queryType:z.ANNOTATION,timeSeriesList:{projectName:(null==a?void 0:a.projectName)||e.getDefaultProject(),filters:(null==a?void 0:a.filters)||[],crossSeriesReducer:"REDUCE_NONE",perSeriesAligner:ee.ALIGN_NONE,title:(null==a?void 0:a.title)||"",text:(null==a?void 0:a.text)||""}}}},prepareQuery:e=>{if(e.target)return t=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){xn(e,t,r[t])}))}return e}({},e.target),r=null!=(r={queryType:z.ANNOTATION,type:"annotationQuery"})?r:{},Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})),t;var t,r},QueryEditor:Pn});function wn(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function Nn(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){wn(a,n,o,i,l,"next",e)}function l(e){wn(a,n,o,i,l,"throw",e)}i(void 0)}))}}function Dn(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Ln{execute(e){var t=this;return Nn((function*(){try{switch(e.projectName||(e.projectName=t.datasource.getDefaultProject()),e.selectedQueryType){case te.Projects:return t.handleProjectsQuery();case te.Services:return t.handleServiceQuery(e);case te.MetricTypes:return t.handleMetricTypesQuery(e);case te.LabelKeys:return t.handleLabelKeysQuery(e);case te.LabelValues:return t.handleLabelValuesQuery(e);case te.ResourceTypes:return t.handleResourceTypeQuery(e);case te.Aligners:return t.handleAlignersQuery(e);case te.AlignmentPeriods:return t.handleAlignmentPeriodQuery();case te.Aggregations:return t.handleAggregationQuery(e);case te.SLOServices:return t.handleSLOServicesQuery(e);case te.SLO:return t.handleSLOQuery(e);case te.Selectors:return t.handleSelectorQuery();default:return[]}}catch(t){return console.error(`Could not run CloudMonitoringMetricFindQuery ${e}`,t),[]}}))()}handleProjectsQuery(){var e=this;return Nn((function*(){return(yield e.datasource.getProjects()).map((e=>({text:e.label,value:e.value,expandable:!0})))}))()}handleServiceQuery({projectName:e}){var t=this;return Nn((function*(){const r=yield t.datasource.getMetricTypes(e);return Ie(r).map((e=>({text:e.serviceShortName,value:e.service,expandable:!0})))}))()}handleMetricTypesQuery({selectedService:e,projectName:t}){var r=this;return Nn((function*(){if(!e)return[];const n=yield r.datasource.getMetricTypes(t);return we(n,r.datasource.templateSrv.replace(e)).map((e=>({text:e.displayName,value:e.type,expandable:!0})))}))()}handleLabelKeysQuery({selectedMetricType:e,projectName:t}){var r=this;return Nn((function*(){return e?(yield _e(r.datasource,e,t)).map(r.toFindQueryResult):[]}))()}handleLabelValuesQuery({selectedMetricType:e,labelKey:t,projectName:r}){var n=this;return Nn((function*(){if(!e)return[];const o=yield n.datasource.getLabels(e,"handleLabelValuesQuery",r,{groupBys:[t],crossSeriesReducer:"REDUCE_MEAN"}),a=n.datasource.templateSrv.replace(t);return(o.hasOwnProperty(a)?o[a]:[]).map(n.toFindQueryResult)}))()}handleResourceTypeQuery({selectedMetricType:e,projectName:t}){var r=this;return Nn((function*(){var n,o;return e&&null!==(o=null===(n=(yield r.datasource.getLabels(e,"handleResourceTypeQueryQueryType",t))["resource.type"])||void 0===n?void 0:n.map(r.toFindQueryResult))&&void 0!==o?o:[]}))()}handleAlignersQuery({selectedMetricType:e,projectName:t}){var r=this;return Nn((function*(){if(!e)return[];const n=(yield r.datasource.getMetricTypes(t)).find((t=>t.type===r.datasource.templateSrv.replace(e)));return n?De(n.valueType,n.metricKind).map(r.toFindQueryResult):[]}))()}handleAggregationQuery({selectedMetricType:e,projectName:t}){var r=this;return Nn((function*(){if(!e)return[];const n=(yield r.datasource.getMetricTypes(t)).find((t=>t.type===r.datasource.templateSrv.replace(e)));return n?Le(n.valueType,n.metricKind).map(r.toFindQueryResult):[]}))()}handleSLOServicesQuery({projectName:e}){var t=this;return Nn((function*(){return(yield t.datasource.getSLOServices(e)).map(t.toFindQueryResult)}))()}handleSLOQuery({selectedSLOService:e,projectName:t}){var r=this;return Nn((function*(){return(yield r.datasource.getServiceLevelObjectives(t,e)).map(r.toFindQueryResult)}))()}handleSelectorQuery(){var e=this;return Nn((function*(){return je.map(e.toFindQueryResult)}))()}handleAlignmentPeriodQuery(){return be.map(this.toFindQueryResult)}toFindQueryResult(t){return(0,e.isString)(t)?{text:t,expandable:!0}:(r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Dn(e,t,r[t])}))}return e}({},t),n=null!=(n={expandable:!0})?n:{},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(n)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(n)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(n,e))})),r);var r,n}constructor(e){Dn(this,"datasource",void 0),this.datasource=e}}function _n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Cn extends t.CustomVariableSupport{query(e){const t=(0,Lr.from)(this.metricFindQuery.execute(e.targets[0]));return(0,Lr.from)(this.datasource.ensureGCEDefaultProject()).pipe(On((()=>t)),pn((e=>({data:e}))))}constructor(e){super(),_n(this,"datasource",void 0),_n(this,"metricFindQuery",void 0),_n(this,"editor",void 0),this.datasource=e,this.editor=Dr,this.metricFindQuery=new Ln(e)}}function An(e,t,r,n,o,a,i){try{var l=e[a](i),s=l.value}catch(e){return void r(e)}l.done?t(s):Promise.resolve(s).then(n,o)}function Rn(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){An(a,n,o,i,l,"next",e)}function l(e){An(a,n,o,i,l,"throw",e)}i(void 0)}))}}function Un(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Mn(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){Un(e,t,r[t])}))}return e}function kn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}class Gn extends r.DataSourceWithBackend{getVariables(){return this.templateSrv.getVariables().map((e=>`$${e.name}`))}query(e){return e.targets=e.targets.map((t=>kn(Mn({},this.migrateQuery(t)),{intervalMs:e.intervalMs}))),super.query(e)}applyTemplateVariables(e,t){const{timeSeriesList:r,timeSeriesQuery:n,sloQuery:o,promQLQuery:a}=e;return kn(Mn({},e),{datasource:this.getRef(),intervalMs:this.intervalMs,timeSeriesList:r&&kn(Mn({},this.interpolateProps(r,t)),{projectName:this.templateSrv.replace(r.projectName?r.projectName:this.getDefaultProject(),t),filters:this.interpolateFilters(r.filters||[],t),groupBys:this.interpolateGroupBys(r.groupBys||[],t),view:r.view||"FULL"}),timeSeriesQuery:n&&kn(Mn({},this.interpolateProps(n,t)),{projectName:this.templateSrv.replace(n.projectName?n.projectName:this.getDefaultProject(),t)}),sloQuery:o&&this.interpolateProps(o,t),promQLQuery:a&&this.interpolateProps(a,t,{expr:this.interpolatePromQLQuery})})}getLabels(e,n,o,a,i){var l=this;return Rn((function*(){var s;const c={targets:[{refId:n,datasource:l.getRef(),queryType:z.TIME_SERIES_LIST,timeSeriesList:Ge({projectName:l.templateSrv.replace(o),groupBys:l.interpolateGroupBys((null==a?void 0:a.groupBys)||[],{}),crossSeriesReducer:null!==(s=null==a?void 0:a.crossSeriesReducer)&&void 0!==s?s:"REDUCE_NONE",view:"HEADERS"},l.templateSrv.replace(e))}],range:i||(0,t.getDefaultTimeRange)()},u=c.targets;return u.length?(0,Lr.lastValueFrom)((0,Lr.from)(l.ensureGCEDefaultProject()).pipe(On((()=>l.backendSrv.fetch({url:"/api/ds/query",method:"POST",headers:l.getRequestHeaders(),data:{from:c.range.from.valueOf().toString(),to:c.range.to.valueOf().toString(),queries:u}}))),pn((({data:e})=>{const t=(0,r.toDataQueryResponse)({data:e}),n=null==t?void 0:t.data.map((e=>{var t,r;return null===(r=e.meta)||void 0===r||null===(t=r.custom)||void 0===t?void 0:t.labels})).filter((e=>!!e)).reduce(((e,t)=>{for(let r in t)e[r]||(e[r]=new Set),t[r]&&e[r].add(t[r]);return e}),{});return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,Array.from(t)])))})))):(0,Lr.lastValueFrom)((0,Lr.of)({results:[]}))}))()}getGCEDefaultProject(){var e=this;return Rn((function*(){return e.getResource("gceDefaultProject")}))()}getDefaultProject(){const{defaultProject:e,authenticationType:t,gceDefaultProject:r}=this.instanceSettings.jsonData;return"gce"===t?r||"":e||""}ensureGCEDefaultProject(){var e=this;return Rn((function*(){const{authenticationType:t,gceDefaultProject:r}=e.instanceSettings.jsonData;"gce"!==t||r||(e.instanceSettings.jsonData.gceDefaultProject=yield e.getGCEDefaultProject())}))()}getMetricTypes(e){var t=this;return Rn((function*(){return e?t.getResource(`metricDescriptors/v3/projects/${t.templateSrv.replace(e)}/metricDescriptors`):[]}))()}filterMetricsByType(e,t){var r=this;return Rn((function*(){return e?r.getResource(`metricDescriptors/v3/projects/${r.templateSrv.replace(e)}/metricDescriptors`,{filter:`metric.type : "${t}"`}):[]}))()}getSLOServices(e){var t=this;return Rn((function*(){return t.getResource(`services/v3/projects/${t.templateSrv.replace(e)}/services?pageSize=1000`)}))()}getServiceLevelObjectives(e,t){var r=this;return Rn((function*(){if(!t)return Promise.resolve([]);let{projectName:n,serviceId:o}=r.interpolateProps({projectName:e,serviceId:t});return r.getResource(`slo-services/v3/projects/${n}/services/${o}/serviceLevelObjectives`)}))()}getProjects(){return this.getResource("projects")}migrateMetricTypeFilter(e,t){const r=["metric.type","=",e];return(null==t?void 0:t.length)?t.concat("AND",r):r}migrateQuery(t){const{hide:r,refId:n,datasource:o,key:a,queryType:i,maxLines:l,metric:s,intervalMs:c,type:u}=t,p=function(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}(t,["hide","refId","datasource","key","queryType","maxLines","metric","intervalMs","type"]);if(!(t.hasOwnProperty("metricQuery")||t.hasOwnProperty("sloQuery")||t.hasOwnProperty("timeSeriesQuery")||t.hasOwnProperty("timeSeriesList"))){let i=p.filters||[];return p.metricType&&(i=this.migrateMetricTypeFilter(p.metricType,i)),{datasource:o,key:a,refId:n,intervalMs:c,hide:r,queryType:"annotationQuery"===u?z.ANNOTATION:z.TIME_SERIES_LIST,timeSeriesList:kn(Mn({},p),{projectName:(0,e.get)(t,"projectName")||this.getDefaultProject(),filters:i,view:p.view||"FULL"})}}var d;if((0,e.has)(t,"metricQuery")&&["metrics",z.ANNOTATION].includes(null!==(d=t.queryType)&&void 0!==d?d:"")){const r=(0,e.get)(t,"metricQuery");"mql"===r.editorMode?(t.timeSeriesQuery={projectName:r.projectName,query:r.query,graphPeriod:r.graphPeriod},t.queryType=z.TIME_SERIES_QUERY):(t.timeSeriesList={projectName:r.projectName||this.getDefaultProject(),crossSeriesReducer:r.crossSeriesReducer,alignmentPeriod:r.alignmentPeriod,perSeriesAligner:r.perSeriesAligner,groupBys:r.groupBys,filters:r.filters,view:r.view,preprocessor:r.preprocessor},t.queryType=z.TIME_SERIES_LIST,r.metricType&&(t.timeSeriesList.filters=this.migrateMetricTypeFilter(r.metricType,t.timeSeriesList.filters))),t.aliasBy=r.aliasBy,t=(0,e.omit)(t,"metricQuery")}if(t.queryType===z.SLO&&(0,e.has)(t,"sloQuery.aliasBy")){const r=(0,e.get)(t,"sloQuery.aliasBy");"string"==typeof r&&(t.aliasBy=r),t=(0,e.omit)(t,"sloQuery.aliasBy")}return t}interpolatePromQLQuery(t,r){return(0,e.isArray)(t)?t.join("|"):t}interpolateProps(t,r={},n){return Object.entries(t).reduce(((t,[o,a])=>{let i=a;return a&&(0,e.isString)(a)&&(i=this.templateSrv.replace(a,r,n&&n[o])),kn(Mn({},t),{[o]:i})}),{})}filterQuery(e){if(e.hide)return!1;const t=this.migrateQuery(e);if(t.queryType===z.SLO){if(!t.sloQuery)return!1;const{selectorName:e,serviceId:r,sloId:n,projectName:o,lookbackPeriod:a}=t.sloQuery;return!(!e||!r||!n||!o||e===Oe&&!a)}return t.queryType===z.TIME_SERIES_QUERY?!!t.timeSeriesQuery&&!!t.timeSeriesQuery.projectName&&!!t.timeSeriesQuery.query:t.queryType&&[z.TIME_SERIES_LIST,z.ANNOTATION].includes(t.queryType)?!!t.timeSeriesList&&!!t.timeSeriesList.projectName&&!!ke(t.timeSeriesList):t.queryType===z.PROMQL&&!!(t.promQLQuery&&t.promQLQuery.projectName&&t.promQLQuery.expr&&t.promQLQuery.step)}interpolateVariablesInQueries(e,t){return e.map((e=>this.applyTemplateVariables(this.migrateQuery(e),t)))}interpolateFilters(t,r){const n=(0,e.chunk)(t,4).map((([e,t,r,n])=>Mn({key:e,operator:t,value:r},n&&{condition:n}))).filter((e=>e.value));return(0,e.flatten)(n.map((({key:t,operator:n,value:o,condition:a})=>[this.templateSrv.replace(t,r||{}),n,this.templateSrv.replace(o,r||{},(t=>(0,e.isArray)(t)&&t.length?`(${t.join("|")})`:t)),...a?[a]:[]])))||[]}interpolateGroupBys(e,t){let r=[];return(e||[]).forEach((e=>{const n=this.templateSrv.replace(e,t||{},"csv").split(",");Array.isArray(n)?r=r.concat(n):r.push(n)})),r}constructor(e,t=(0,r.getTemplateSrv)()){super(e),Un(this,"instanceSettings",void 0),Un(this,"templateSrv",void 0),Un(this,"authenticationType",void 0),Un(this,"intervalMs",void 0),Un(this,"backendSrv",void 0),this.instanceSettings=e,this.templateSrv=t,this.authenticationType=e.jsonData.authenticationType||"jwt",this.variables=new Cn(this),this.intervalMs=0,this.annotations=In(this),this.backendSrv=(0,r.getBackendSrv)()}}const Qn=new t.DataSourcePlugin(Gn).setQueryEditorHelp(l).setQueryEditor((r=>{var o,i;const{datasource:l,query:c,onRunQuery:u,onChange:p,range:d}=r,[y,f]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=l.migrateQuery(c);B()(e,c)||p(Sr({},e))}),[c,l,p]);const[m,b]=(0,a.useState)(c),[v,h]=(0,a.useState)(!1),g=Sr({},{projectName:l.getDefaultProject(),alignmentPeriod:"cloud-monitoring-auto",perSeriesAligner:ee.ALIGN_MEAN,aliasBy:"",selectorName:"select_slo_health",serviceId:"",serviceName:"",sloId:"",sloName:"",lookbackPeriod:""},c.sloQuery),O=Sr({},{projectName:l.getDefaultProject(),expr:"",step:"10s"},c.promQLQuery),j=(null===(o=r.data)||void 0===o?void 0:o.series.length)?null===(i=r.data)||void 0===i?void 0:i.series[0].meta:{};var E;const S=null!==(E=null==j?void 0:j.custom)&&void 0!==E?E:{},T={label:"Template Variables",expanded:!1,options:l.getVariables().map(t.toOption)};(0,a.useEffect)((()=>{c.queryType&&Object.values(z).includes(c.queryType)||p(Tr(Sr({},c),{queryType:z.TIME_SERIES_LIST}))}));const P=c.queryType;return(0,n.jsx)("span",{"data-testid":W.components.queryEditor.container,children:(0,n.jsxs)(J,{children:[(0,n.jsx)(s.ConfirmModal,{"data-testid":"switch-query-type-modal",title:"Warning",body:"By switching your query type, your current query will be lost.",isOpen:y,onConfirm:()=>{f(!1),p(m),h(!1)},confirmText:"Confirm",onDismiss:()=>{f(!1),b(c)}}),(0,n.jsx)(jr,{query:c,onChange:e=>{!v||m.queryType!==z.TIME_SERIES_LIST&&m.queryType!==z.TIME_SERIES_QUERY?p(e):m.queryType!==e.queryType&&f(!0),b(e)},onRunQuery:u}),P===z.PROMQL&&(0,n.jsx)(nr,{refId:c.refId,variableOptionGroup:T,onChange:e=>{p(Tr(Sr({},c),{promQLQuery:e}))},onRunQuery:u,datasource:l,query:O}),P!==z.SLO&&(0,n.jsx)(Zt,{refId:c.refId,variableOptionGroup:T,customMetaData:S,onChange:t=>{(t.queryType===z.TIME_SERIES_LIST&&!(0,e.isEqual)(t.timeSeriesList,zt(l))||t.queryType===z.TIME_SERIES_QUERY&&!(0,e.isEqual)(t.timeSeriesQuery,Ht(l)))&&h(!0),p(t)},onRunQuery:u,datasource:l,query:c,range:d||(0,t.getDefaultTimeRange)()}),P===z.SLO&&(0,n.jsx)(Nt,{refId:c.refId,variableOptionGroup:T,customMetaData:S,onChange:e=>{p(Tr(Sr({},c),{sloQuery:e})),u()},onRunQuery:u,datasource:l,query:g,aliasBy:c.aliasBy,onChangeAliasBy:e=>p(Tr(Sr({},c),{aliasBy:e}))})]})})})).setConfigEditor(Q).setVariableQueryEditor(Dr);(0,r.getAppEvents)().subscribe(t.DashboardLoadedEvent,(({payload:{dashboardId:t,orgId:n,grafanaVersion:o,queries:a}})=>{const i=a.stackdriver;let l={[z.TIME_SERIES_QUERY]:0,[z.TIME_SERIES_LIST]:0,[z.SLO]:0,[z.ANNOTATION]:0,[z.PROMQL]:0};var s;i.forEach((t=>{t.queryType===z.TIME_SERIES_QUERY||t.queryType===z.TIME_SERIES_LIST||t.queryType===z.SLO||t.queryType===z.ANNOTATION||t.queryType===z.PROMQL?l[t.queryType]++:"metrics"===t.queryType&&(t.hasOwnProperty("type")&&"annotationQuery"===(0,e.get)(t,"type")&&l.annotation++,"mql"===(0,e.get)(t,"metricQuery.editorMode")?l.timeSeriesQuery++:l.timeSeriesList++)})),i&&i.length>0&&(s={grafana_version:o,dashboard_id:t,org_id:n,mql_queries:l[z.TIME_SERIES_QUERY],time_series_filter_queries:l[z.TIME_SERIES_LIST],slo_queries:l[z.SLO],annotation_queries:l[z.ANNOTATION],promQL_queries:l[z.PROMQL]},(0,r.reportInteraction)("grafana_ds_cloudmonitoring_dashboard_loaded",s))}))})(),u})()));
//# sourceMappingURL=module.js.map